import{$a as qu,$d as yc,Aa as Re,Ad as ic,B as In,Ba as Mu,Bb as zu,Cc as Hu,Da as Er,Dc as Ju,Ed as sc,Ga as Ar,H as pr,I as _r,Ic as Yu,Id as Ct,J as Rt,Ja as Xi,Jd as oc,Kc as Xu,Kd as Dt,L as j,Lc as Sn,Ld as ac,M as Tn,Mc as Zu,Nc as tc,Nd as uc,O as xu,Oa as Lu,Oc as rs,Od as cc,Pa as Bu,Pd as lc,Qc as Ce,Qd as hc,Rc as Rr,Rd as Rn,Sa as Zi,Sc as is,Sd as dc,Td as fc,Ud as mc,V as yr,Vd as gc,W as de,Wd as Ut,Xd as pc,Y as Vu,Yd as _c,Z as vr,a as Bt,ab as Uu,b as Ru,ba as wr,bb as Gu,cc as ts,d as V,de as vc,f as Cu,fc as $u,g as qt,ha as ku,ic as br,jc as es,k as Du,ka as Nu,mc as Ku,n as fr,oc as ns,p as mr,pc as Qu,qa as Ou,qc as Wu,r as Pu,rc as An,s as Se,sc as bn,ta as Fu,u as gr,ub as ju,vc as Sr,wd as ec,xa as Ir,xd as nc,ya as Tr,yd as rc,za as En}from"./chunk-HJUHHJF5.js";function nd(r,t){}var ne=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext};var as=(()=>{class r extends Wu{_elementRef=j(wr);_focusTrapFactory=j(Ju);_config;_interactivityChecker=j(Hu);_ngZone=j(vr);_overlayRef=j(rs);_focusMonitor=j(Yu);_renderer=j(Fu);_platform=j($u);_document=j(zu,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=j(ju);_injector=j(de);_isDestroyed=!1;constructor(){super(),this._config=j(ne,{optional:!0})||new ne,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(e){this._ariaLabelledByQueue.push(e),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(e){let n=this._ariaLabelledByQueue.indexOf(e);n>-1&&(this._ariaLabelledByQueue.splice(n,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();let n=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),n}attachTemplatePortal(e){this._portalOutlet.hasAttached();let n=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),n}attachDomPortal=e=>{this._portalOutlet.hasAttached();let n=this._portalOutlet.attachDomPortal(e);return this._contentAttached(),n};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,n){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let s=()=>{o(),u(),e.removeAttribute("tabindex")},o=this._renderer.listen(e,"blur",s),u=this._renderer.listen(e,"mousedown",s)})),e.focus(n)}_focusByCssSelector(e,n){let s=this._elementRef.nativeElement.querySelector(e);s&&this._forceFocus(s,n)}_trapFocus(){this._isDestroyed||Nu(()=>{let e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement()||this._focusDialogContainer();break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}},{injector:this._injector})}_restoreFocus(){let e=this._config.restoreFocus,n=null;if(typeof e=="string"?n=this._document.querySelector(e):typeof e=="boolean"?n=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(n=e),this._config.restoreFocus&&n&&typeof n.focus=="function"){let s=br(),o=this._elementRef.nativeElement;(!s||s===this._document.body||s===o||o.contains(s))&&(this._focusMonitor?(this._focusMonitor.focusVia(n,this._closeInteractionType),this._closeInteractionType=null):n.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let e=this._elementRef.nativeElement,n=br();return e===n||e.contains(n)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=br()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=Ir({type:r,selectors:[["cdk-dialog-container"]],viewQuery:function(n,s){if(n&1&&qu(An,7),n&2){let o;Uu(o=Gu())&&(s._portalOutlet=o.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(n,s){n&2&&Ar("id",s._config.id||null)("role",s._config.role)("aria-modal",s._config.ariaModal)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null)},features:[Re],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(n,s){n&1&&Er(0,nd,0,0,"ng-template",0)},dependencies:[An],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return r})(),Cn=class{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new qt;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(t,e){this.overlayRef=t,this.config=e,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(n=>{n.keyCode===27&&!this.disableClose&&!Sr(n)&&(n.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=t.detachments().subscribe(()=>{e.closeOnOverlayDetachments!==!1&&this.close()})}close(t,e){if(this.containerInstance){let n=this.closed;this.containerInstance._closeInteractionType=e?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),n.next(t),n.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}},rd=new Rt("DialogScrollStrategy",{providedIn:"root",factory:()=>{let r=j(Ce);return()=>r.scrollStrategies.block()}}),id=new Rt("DialogData"),sd=new Rt("DefaultDialogConfig");var us=(()=>{class r{_overlay=j(Ce);_injector=j(de);_defaultOptions=j(sd,{optional:!0});_parentDialog=j(r,{optional:!0,skipSelf:!0});_overlayContainer=j(tc);_idGenerator=j(Sn);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new qt;_afterOpenedAtThisLevel=new qt;_ariaHiddenElements=new Map;_scrollStrategy=j(rd);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=mr(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(In(void 0)));constructor(){}open(e,n){let s=this._defaultOptions||new ne;n=Bt(Bt({},s),n),n.id=n.id||this._idGenerator.getId("cdk-dialog-"),n.id&&this.getDialogById(n.id);let o=this._getOverlayConfig(n),u=this._overlay.create(o),l=new Cn(u,n),h=this._attachContainer(u,l,n);return l.containerInstance=h,this._attachDialogContent(e,l,h,n),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(l),l.closed.subscribe(()=>this._removeOpenDialog(l,!0)),this.afterOpened.next(l),l}closeAll(){ss(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(n=>n.id===e)}ngOnDestroy(){ss(this._openDialogsAtThisLevel,e=>{e.config.closeOnDestroy===!1&&this._removeOpenDialog(e,!1)}),ss(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){let n=new Zu({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(n.backdropClass=e.backdropClass),n}_attachContainer(e,n,s){let o=s.injector||s.viewContainerRef?.injector,u=[{provide:ne,useValue:s},{provide:Cn,useValue:n},{provide:rs,useValue:e}],l;s.container?typeof s.container=="function"?l=s.container:(l=s.container.type,u.push(...s.container.providers(s))):l=as;let h=new ns(l,s.viewContainerRef,de.create({parent:o||this._injector,providers:u}));return e.attach(h).instance}_attachDialogContent(e,n,s,o){if(e instanceof Ou){let u=this._createInjector(o,n,s,void 0),l={$implicit:o.data,dialogRef:n};o.templateContext&&(l=Bt(Bt({},l),typeof o.templateContext=="function"?o.templateContext():o.templateContext)),s.attachTemplatePortal(new Qu(e,null,l,u))}else{let u=this._createInjector(o,n,s,this._injector),l=s.attachComponentPortal(new ns(e,o.viewContainerRef,u));n.componentRef=l,n.componentInstance=l.instance}}_createInjector(e,n,s,o){let u=e.injector||e.viewContainerRef?.injector,l=[{provide:id,useValue:e.data},{provide:Cn,useValue:n}];return e.providers&&(typeof e.providers=="function"?l.push(...e.providers(n,e,s)):l.push(...e.providers)),e.direction&&(!u||!u.get(es,null,{optional:!0}))&&l.push({provide:es,useValue:{value:e.direction,change:Du()}}),de.create({parent:u||o,providers:l})}_removeOpenDialog(e,n){let s=this.openDialogs.indexOf(e);s>-1&&(this.openDialogs.splice(s,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((o,u)=>{o?u.setAttribute("aria-hidden",o):u.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),n&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let e=this._overlayContainer.getContainerElement();if(e.parentElement){let n=e.parentElement.children;for(let s=n.length-1;s>-1;s--){let o=n[s];o!==e&&o.nodeName!=="SCRIPT"&&o.nodeName!=="STYLE"&&!o.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(o,o.getAttribute("aria-hidden")),o.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(n){return new(n||r)};static \u0275prov=pr({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function ss(r,t){let e=r.length;for(;e--;)t(r[e])}var wc=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=Tr({type:r});static \u0275inj=_r({providers:[us],imports:[Rr,bn,Xu,bn]})}return r})();function od(r,t){}var Dr=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;componentFactoryResolver;enterAnimationDuration;exitAnimationDuration},cs="mdc-dialog--open",Ic="mdc-dialog--opening",Tc="mdc-dialog--closing",ad=150,ud=75,cd=(()=>{class r extends as{_animationMode=j(ku,{optional:!0});_animationStateChanged=new Vu;_animationsEnabled=this._animationMode!=="NoopAnimations";_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?Ac(this._config.enterAnimationDuration)??ad:0;_exitAnimationDuration=this._animationsEnabled?Ac(this._config.exitAnimationDuration)??ud:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(Ec,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(Ic,cs)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(cs),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(cs),this._animationsEnabled?(this._hostElement.style.setProperty(Ec,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(Tc)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(e){this._actionSectionCount+=e,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(Ic,Tc)}_waitForAnimationToComplete(e,n){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(n,e)}_requestAnimationFrame(e){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(e):e()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(e){let n=super.attachComponentPortal(e);return n.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),n}static \u0275fac=(()=>{let e;return function(s){return(e||(e=yr(r)))(s||r)}})();static \u0275cmp=Ir({type:r,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(n,s){n&2&&(Zi("id",s._config.id),Ar("aria-modal",s._config.ariaModal)("role",s._config.role)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null),Xi("_mat-animation-noopable",!s._animationsEnabled)("mat-mdc-dialog-container-with-actions",s._actionSectionCount>0))},features:[Re],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(n,s){n&1&&(Lu(0,"div",0)(1,"div",1),Er(2,od,0,0,"ng-template",2),Bu()())},dependencies:[An],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mdc-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mdc-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mdc-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mdc-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mdc-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mdc-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mdc-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mdc-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mdc-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mdc-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mdc-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mdc-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}'],encapsulation:2})}return r})(),Ec="--mat-dialog-transition-duration";function Ac(r){return r==null?null:typeof r=="number"?r:r.endsWith("ms")?ts(r.substring(0,r.length-2)):r.endsWith("s")?ts(r.substring(0,r.length-1))*1e3:r==="0"?0:null}var Cr=function(r){return r[r.OPEN=0]="OPEN",r[r.CLOSING=1]="CLOSING",r[r.CLOSED=2]="CLOSED",r}(Cr||{}),Pr=class{_ref;_containerInstance;componentInstance;componentRef;disableClose;id;_afterOpened=new qt;_beforeClosed=new qt;_result;_closeFallbackTimeout;_state=Cr.OPEN;_closeInteractionType;constructor(t,e,n){this._ref=t,this._containerInstance=n,this.disableClose=e.disableClose,this.id=t.id,t.addPanelClass("mat-mdc-dialog-panel"),n._animationStateChanged.pipe(Se(s=>s.state==="opened"),gr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),n._animationStateChanged.pipe(Se(s=>s.state==="closed"),gr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Pu(this.backdropClick(),this.keydownEvents().pipe(Se(s=>s.keyCode===27&&!this.disableClose&&!Sr(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),ld(this,s.type==="keydown"?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Se(e=>e.state==="closing"),gr(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=Cr.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(t){let e=this._ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._ref.updatePosition(),this}updateSize(t="",e=""){return this._ref.updateSize(t,e),this}addPanelClass(t){return this._ref.addPanelClass(t),this}removePanelClass(t){return this._ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=Cr.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function ld(r,t,e){return r._closeInteractionType=t,r.close(e)}var hd=new Rt("MatMdcDialogData"),dd=new Rt("mat-mdc-dialog-default-options"),fd=new Rt("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let r=j(Ce);return()=>r.scrollStrategies.block()}});var bc=(()=>{class r{_overlay=j(Ce);_defaultOptions=j(dd,{optional:!0});_scrollStrategy=j(fd);_parentDialog=j(r,{optional:!0,skipSelf:!0});_idGenerator=j(Sn);_dialog=j(us);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new qt;_afterOpenedAtThisLevel=new qt;dialogConfigClass=Dr;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=mr(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(In(void 0)));constructor(){this._dialogRefConstructor=Pr,this._dialogContainerType=cd,this._dialogDataToken=hd}open(e,n){let s;n=Bt(Bt({},this._defaultOptions||new Dr),n),n.id=n.id||this._idGenerator.getId("mat-mdc-dialog-"),n.scrollStrategy=n.scrollStrategy||this._scrollStrategy();let o=this._dialog.open(e,Ru(Bt({},n),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:n},{provide:ne,useValue:n}]},templateContext:()=>({dialogRef:s}),providers:(u,l,h)=>(s=new this._dialogRefConstructor(u,n,h),s.updatePosition(n?.position),[{provide:this._dialogContainerType,useValue:h},{provide:this._dialogDataToken,useValue:l.data},{provide:this._dialogRefConstructor,useValue:s}])}));return s.componentRef=o.componentRef,s.componentInstance=o.componentInstance,this.openDialogs.push(s),this.afterOpened.next(s),s.afterClosed().subscribe(()=>{let u=this.openDialogs.indexOf(s);u>-1&&(this.openDialogs.splice(u,1),this.openDialogs.length||this._getAfterAllClosed().next())}),s}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(n=>n.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let n=e.length;for(;n--;)e[n].close()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=pr({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Sc=(()=>{class r{_dialogRef=j(Pr,{optional:!0});_elementRef=j(wr);_dialog=j(bc);constructor(){}ngOnInit(){this._dialogRef||(this._dialogRef=md(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}static \u0275fac=function(n){return new(n||r)};static \u0275dir=En({type:r})}return r})(),ig=(()=>{class r extends Sc{id=j(Sn).getId("mat-mdc-dialog-title-");_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}static \u0275fac=(()=>{let e;return function(s){return(e||(e=yr(r)))(s||r)}})();static \u0275dir=En({type:r,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(n,s){n&2&&Zi("id",s.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],features:[Re]})}return r})(),sg=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275dir=En({type:r,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],features:[Mu([Ku])]})}return r})(),og=(()=>{class r extends Sc{align;_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}static \u0275fac=(()=>{let e;return function(s){return(e||(e=yr(r)))(s||r)}})();static \u0275dir=En({type:r,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(n,s){n&2&&Xi("mat-mdc-dialog-actions-align-start",s.align==="start")("mat-mdc-dialog-actions-align-center",s.align==="center")("mat-mdc-dialog-actions-align-end",s.align==="end")},inputs:{align:"align"},features:[Re]})}return r})();function md(r,t){let e=r.nativeElement.parentElement;for(;e&&!e.classList.contains("mat-mdc-dialog-container");)e=e.parentElement;return e?t.find(n=>n.id===e.id):null}var ag=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=Tr({type:r});static \u0275inj=_r({providers:[bc],imports:[wc,Rr,bn,is,is]})}return r})();var Rc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Cc={};var Gt,ls;(function(){var r;function t(w,m){function _(){}_.prototype=m.prototype,w.D=m.prototype,w.prototype=new _,w.prototype.constructor=w,w.C=function(y,v,E){for(var g=Array(arguments.length-2),Ft=2;Ft<arguments.length;Ft++)g[Ft-2]=arguments[Ft];return m.prototype[v].apply(y,g)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,m,_){_||(_=0);var y=Array(16);if(typeof m=="string")for(var v=0;16>v;++v)y[v]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(v=0;16>v;++v)y[v]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=w.g[0],_=w.g[1],v=w.g[2];var E=w.g[3],g=m+(E^_&(v^E))+y[0]+3614090360&4294967295;m=_+(g<<7&4294967295|g>>>25),g=E+(v^m&(_^v))+y[1]+3905402710&4294967295,E=m+(g<<12&4294967295|g>>>20),g=v+(_^E&(m^_))+y[2]+606105819&4294967295,v=E+(g<<17&4294967295|g>>>15),g=_+(m^v&(E^m))+y[3]+3250441966&4294967295,_=v+(g<<22&4294967295|g>>>10),g=m+(E^_&(v^E))+y[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=E+(v^m&(_^v))+y[5]+1200080426&4294967295,E=m+(g<<12&4294967295|g>>>20),g=v+(_^E&(m^_))+y[6]+2821735955&4294967295,v=E+(g<<17&4294967295|g>>>15),g=_+(m^v&(E^m))+y[7]+4249261313&4294967295,_=v+(g<<22&4294967295|g>>>10),g=m+(E^_&(v^E))+y[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=E+(v^m&(_^v))+y[9]+2336552879&4294967295,E=m+(g<<12&4294967295|g>>>20),g=v+(_^E&(m^_))+y[10]+4294925233&4294967295,v=E+(g<<17&4294967295|g>>>15),g=_+(m^v&(E^m))+y[11]+2304563134&4294967295,_=v+(g<<22&4294967295|g>>>10),g=m+(E^_&(v^E))+y[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=E+(v^m&(_^v))+y[13]+4254626195&4294967295,E=m+(g<<12&4294967295|g>>>20),g=v+(_^E&(m^_))+y[14]+2792965006&4294967295,v=E+(g<<17&4294967295|g>>>15),g=_+(m^v&(E^m))+y[15]+1236535329&4294967295,_=v+(g<<22&4294967295|g>>>10),g=m+(v^E&(_^v))+y[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=E+(_^v&(m^_))+y[6]+3225465664&4294967295,E=m+(g<<9&4294967295|g>>>23),g=v+(m^_&(E^m))+y[11]+643717713&4294967295,v=E+(g<<14&4294967295|g>>>18),g=_+(E^m&(v^E))+y[0]+3921069994&4294967295,_=v+(g<<20&4294967295|g>>>12),g=m+(v^E&(_^v))+y[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=E+(_^v&(m^_))+y[10]+38016083&4294967295,E=m+(g<<9&4294967295|g>>>23),g=v+(m^_&(E^m))+y[15]+3634488961&4294967295,v=E+(g<<14&4294967295|g>>>18),g=_+(E^m&(v^E))+y[4]+3889429448&4294967295,_=v+(g<<20&4294967295|g>>>12),g=m+(v^E&(_^v))+y[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=E+(_^v&(m^_))+y[14]+3275163606&4294967295,E=m+(g<<9&4294967295|g>>>23),g=v+(m^_&(E^m))+y[3]+4107603335&4294967295,v=E+(g<<14&4294967295|g>>>18),g=_+(E^m&(v^E))+y[8]+1163531501&4294967295,_=v+(g<<20&4294967295|g>>>12),g=m+(v^E&(_^v))+y[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=E+(_^v&(m^_))+y[2]+4243563512&4294967295,E=m+(g<<9&4294967295|g>>>23),g=v+(m^_&(E^m))+y[7]+1735328473&4294967295,v=E+(g<<14&4294967295|g>>>18),g=_+(E^m&(v^E))+y[12]+2368359562&4294967295,_=v+(g<<20&4294967295|g>>>12),g=m+(_^v^E)+y[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=E+(m^_^v)+y[8]+2272392833&4294967295,E=m+(g<<11&4294967295|g>>>21),g=v+(E^m^_)+y[11]+1839030562&4294967295,v=E+(g<<16&4294967295|g>>>16),g=_+(v^E^m)+y[14]+4259657740&4294967295,_=v+(g<<23&4294967295|g>>>9),g=m+(_^v^E)+y[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=E+(m^_^v)+y[4]+1272893353&4294967295,E=m+(g<<11&4294967295|g>>>21),g=v+(E^m^_)+y[7]+4139469664&4294967295,v=E+(g<<16&4294967295|g>>>16),g=_+(v^E^m)+y[10]+3200236656&4294967295,_=v+(g<<23&4294967295|g>>>9),g=m+(_^v^E)+y[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=E+(m^_^v)+y[0]+3936430074&4294967295,E=m+(g<<11&4294967295|g>>>21),g=v+(E^m^_)+y[3]+3572445317&4294967295,v=E+(g<<16&4294967295|g>>>16),g=_+(v^E^m)+y[6]+76029189&4294967295,_=v+(g<<23&4294967295|g>>>9),g=m+(_^v^E)+y[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=E+(m^_^v)+y[12]+3873151461&4294967295,E=m+(g<<11&4294967295|g>>>21),g=v+(E^m^_)+y[15]+530742520&4294967295,v=E+(g<<16&4294967295|g>>>16),g=_+(v^E^m)+y[2]+3299628645&4294967295,_=v+(g<<23&4294967295|g>>>9),g=m+(v^(_|~E))+y[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=E+(_^(m|~v))+y[7]+1126891415&4294967295,E=m+(g<<10&4294967295|g>>>22),g=v+(m^(E|~_))+y[14]+2878612391&4294967295,v=E+(g<<15&4294967295|g>>>17),g=_+(E^(v|~m))+y[5]+4237533241&4294967295,_=v+(g<<21&4294967295|g>>>11),g=m+(v^(_|~E))+y[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=E+(_^(m|~v))+y[3]+2399980690&4294967295,E=m+(g<<10&4294967295|g>>>22),g=v+(m^(E|~_))+y[10]+4293915773&4294967295,v=E+(g<<15&4294967295|g>>>17),g=_+(E^(v|~m))+y[1]+2240044497&4294967295,_=v+(g<<21&4294967295|g>>>11),g=m+(v^(_|~E))+y[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=E+(_^(m|~v))+y[15]+4264355552&4294967295,E=m+(g<<10&4294967295|g>>>22),g=v+(m^(E|~_))+y[6]+2734768916&4294967295,v=E+(g<<15&4294967295|g>>>17),g=_+(E^(v|~m))+y[13]+1309151649&4294967295,_=v+(g<<21&4294967295|g>>>11),g=m+(v^(_|~E))+y[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=E+(_^(m|~v))+y[11]+3174756917&4294967295,E=m+(g<<10&4294967295|g>>>22),g=v+(m^(E|~_))+y[2]+718787259&4294967295,v=E+(g<<15&4294967295|g>>>17),g=_+(E^(v|~m))+y[9]+3951481745&4294967295,w.g[0]=w.g[0]+m&4294967295,w.g[1]=w.g[1]+(v+(g<<21&4294967295|g>>>11))&4294967295,w.g[2]=w.g[2]+v&4294967295,w.g[3]=w.g[3]+E&4294967295}n.prototype.u=function(w,m){m===void 0&&(m=w.length);for(var _=m-this.blockSize,y=this.B,v=this.h,E=0;E<m;){if(v==0)for(;E<=_;)s(this,w,E),E+=this.blockSize;if(typeof w=="string"){for(;E<m;)if(y[v++]=w.charCodeAt(E++),v==this.blockSize){s(this,y),v=0;break}}else for(;E<m;)if(y[v++]=w[E++],v==this.blockSize){s(this,y),v=0;break}}this.h=v,this.o+=m},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var m=1;m<w.length-8;++m)w[m]=0;var _=8*this.o;for(m=w.length-8;m<w.length;++m)w[m]=_&255,_/=256;for(this.u(w),w=Array(16),m=_=0;4>m;++m)for(var y=0;32>y;y+=8)w[_++]=this.g[m]>>>y&255;return w};function o(w,m){var _=l;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=m(w)}function u(w,m){this.h=m;for(var _=[],y=!0,v=w.length-1;0<=v;v--){var E=w[v]|0;y&&E==m||(_[v]=E,y=!1)}this.g=_}var l={};function h(w){return-128<=w&&128>w?o(w,function(m){return new u([m|0],0>m?-1:0)}):new u([w|0],0>w?-1:0)}function f(w){if(isNaN(w)||!isFinite(w))return T;if(0>w)return P(f(-w));for(var m=[],_=1,y=0;w>=_;y++)m[y]=w/_|0,_*=4294967296;return new u(m,0)}function p(w,m){if(w.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(w.charAt(0)=="-")return P(p(w.substring(1),m));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=f(Math.pow(m,8)),y=T,v=0;v<w.length;v+=8){var E=Math.min(8,w.length-v),g=parseInt(w.substring(v,v+E),m);8>E?(E=f(Math.pow(m,E)),y=y.j(E).add(f(g))):(y=y.j(_),y=y.add(f(g)))}return y}var T=h(0),b=h(1),C=h(16777216);r=u.prototype,r.m=function(){if(N(this))return-P(this).m();for(var w=0,m=1,_=0;_<this.g.length;_++){var y=this.i(_);w+=(0<=y?y:4294967296+y)*m,m*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(x(this))return"0";if(N(this))return"-"+P(this).toString(w);for(var m=f(Math.pow(w,6)),_=this,y="";;){var v=Z(_,m).g;_=U(_,v.j(m));var E=((0<_.g.length?_.g[0]:_.h)>>>0).toString(w);if(_=v,x(_))return E+y;for(;6>E.length;)E="0"+E;y=E+y}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function x(w){if(w.h!=0)return!1;for(var m=0;m<w.g.length;m++)if(w.g[m]!=0)return!1;return!0}function N(w){return w.h==-1}r.l=function(w){return w=U(this,w),N(w)?-1:x(w)?0:1};function P(w){for(var m=w.g.length,_=[],y=0;y<m;y++)_[y]=~w.g[y];return new u(_,~w.h).add(b)}r.abs=function(){return N(this)?P(this):this},r.add=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],y=0,v=0;v<=m;v++){var E=y+(this.i(v)&65535)+(w.i(v)&65535),g=(E>>>16)+(this.i(v)>>>16)+(w.i(v)>>>16);y=g>>>16,E&=65535,g&=65535,_[v]=g<<16|E}return new u(_,_[_.length-1]&-2147483648?-1:0)};function U(w,m){return w.add(P(m))}r.j=function(w){if(x(this)||x(w))return T;if(N(this))return N(w)?P(this).j(P(w)):P(P(this).j(w));if(N(w))return P(this.j(P(w)));if(0>this.l(C)&&0>w.l(C))return f(this.m()*w.m());for(var m=this.g.length+w.g.length,_=[],y=0;y<2*m;y++)_[y]=0;for(y=0;y<this.g.length;y++)for(var v=0;v<w.g.length;v++){var E=this.i(y)>>>16,g=this.i(y)&65535,Ft=w.i(v)>>>16,en=w.i(v)&65535;_[2*y+2*v]+=g*en,$(_,2*y+2*v),_[2*y+2*v+1]+=E*en,$(_,2*y+2*v+1),_[2*y+2*v+1]+=g*Ft,$(_,2*y+2*v+1),_[2*y+2*v+2]+=E*Ft,$(_,2*y+2*v+2)}for(y=0;y<m;y++)_[y]=_[2*y+1]<<16|_[2*y];for(y=m;y<2*m;y++)_[y]=0;return new u(_,0)};function $(w,m){for(;(w[m]&65535)!=w[m];)w[m+1]+=w[m]>>>16,w[m]&=65535,m++}function Q(w,m){this.g=w,this.h=m}function Z(w,m){if(x(m))throw Error("division by zero");if(x(w))return new Q(T,T);if(N(w))return m=Z(P(w),m),new Q(P(m.g),P(m.h));if(N(m))return m=Z(w,P(m)),new Q(P(m.g),m.h);if(30<w.g.length){if(N(w)||N(m))throw Error("slowDivide_ only works with positive integers.");for(var _=b,y=m;0>=y.l(w);)_=Tt(_),y=Tt(y);var v=J(_,1),E=J(y,1);for(y=J(y,2),_=J(_,2);!x(y);){var g=E.add(y);0>=g.l(w)&&(v=v.add(_),E=g),y=J(y,1),_=J(_,1)}return m=U(w,v.j(m)),new Q(v,m)}for(v=T;0<=w.l(m);){for(_=Math.max(1,Math.floor(w.m()/m.m())),y=Math.ceil(Math.log(_)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),E=f(_),g=E.j(m);N(g)||0<g.l(w);)_-=y,E=f(_),g=E.j(m);x(E)&&(E=b),v=v.add(E),w=U(w,g)}return new Q(v,w)}r.A=function(w){return Z(this,w).h},r.and=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],y=0;y<m;y++)_[y]=this.i(y)&w.i(y);return new u(_,this.h&w.h)},r.or=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],y=0;y<m;y++)_[y]=this.i(y)|w.i(y);return new u(_,this.h|w.h)},r.xor=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],y=0;y<m;y++)_[y]=this.i(y)^w.i(y);return new u(_,this.h^w.h)};function Tt(w){for(var m=w.g.length+1,_=[],y=0;y<m;y++)_[y]=w.i(y)<<1|w.i(y-1)>>>31;return new u(_,w.h)}function J(w,m){var _=m>>5;m%=32;for(var y=w.g.length-_,v=[],E=0;E<y;E++)v[E]=0<m?w.i(E+_)>>>m|w.i(E+_+1)<<32-m:w.i(E+_);return new u(v,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,ls=Cc.Md5=n,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=f,u.fromString=p,Gt=Cc.Integer=u}).apply(typeof Rc<"u"?Rc:typeof self<"u"?self:typeof window<"u"?window:{});var xr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jt={};var hs,gd,De,ds,Dn,Vr,fs,ms,gs;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,a,c){return i==Array.prototype||i==Object.prototype||(i[a]=c.value),i};function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof xr=="object"&&xr];for(var a=0;a<i.length;++a){var c=i[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")}var n=e(this);function s(i,a){if(a)t:{var c=n;i=i.split(".");for(var d=0;d<i.length-1;d++){var I=i[d];if(!(I in c))break t;c=c[I]}i=i[i.length-1],d=c[i],a=a(d),a!=d&&a!=null&&t(c,i,{configurable:!0,writable:!0,value:a})}}function o(i,a){i instanceof String&&(i+="");var c=0,d=!1,I={next:function(){if(!d&&c<i.length){var A=c++;return{value:a(A,i[A]),done:!1}}return d=!0,{done:!0,value:void 0}}};return I[Symbol.iterator]=function(){return I},I}s("Array.prototype.values",function(i){return i||function(){return o(this,function(a,c){return c})}});var u=u||{},l=this||self;function h(i){var a=typeof i;return a=a!="object"?a:i?Array.isArray(i)?"array":a:"null",a=="array"||a=="object"&&typeof i.length=="number"}function f(i){var a=typeof i;return a=="object"&&i!=null||a=="function"}function p(i,a,c){return i.call.apply(i.bind,arguments)}function T(i,a,c){if(!i)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var I=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(I,d),i.apply(a,I)}}return function(){return i.apply(a,arguments)}}function b(i,a,c){return b=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:T,b.apply(null,arguments)}function C(i,a){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();return d.push.apply(d,arguments),i.apply(this,d)}}function x(i,a){function c(){}c.prototype=a.prototype,i.aa=a.prototype,i.prototype=new c,i.prototype.constructor=i,i.Qb=function(d,I,A){for(var D=Array(arguments.length-2),H=2;H<arguments.length;H++)D[H-2]=arguments[H];return a.prototype[I].apply(d,D)}}function N(i){let a=i.length;if(0<a){let c=Array(a);for(let d=0;d<a;d++)c[d]=i[d];return c}return[]}function P(i,a){for(let c=1;c<arguments.length;c++){let d=arguments[c];if(h(d)){let I=i.length||0,A=d.length||0;i.length=I+A;for(let D=0;D<A;D++)i[I+D]=d[D]}else i.push(d)}}class U{constructor(a,c){this.i=a,this.j=c,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function $(i){return/^[\s\xa0]*$/.test(i)}function Q(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function Z(i){return Z[" "](i),i}Z[" "]=function(){};var Tt=Q().indexOf("Gecko")!=-1&&!(Q().toLowerCase().indexOf("webkit")!=-1&&Q().indexOf("Edge")==-1)&&!(Q().indexOf("Trident")!=-1||Q().indexOf("MSIE")!=-1)&&Q().indexOf("Edge")==-1;function J(i,a,c){for(let d in i)a.call(c,i[d],d,i)}function w(i,a){for(let c in i)a.call(void 0,i[c],c,i)}function m(i){let a={};for(let c in i)a[c]=i[c];return a}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function y(i,a){let c,d;for(let I=1;I<arguments.length;I++){d=arguments[I];for(c in d)i[c]=d[c];for(let A=0;A<_.length;A++)c=_[A],Object.prototype.hasOwnProperty.call(d,c)&&(i[c]=d[c])}}function v(i){var a=1;i=i.split(":");let c=[];for(;0<a&&i.length;)c.push(i.shift()),a--;return i.length&&c.push(i.join(":")),c}function E(i){l.setTimeout(()=>{throw i},0)}function g(){var i=Ri;let a=null;return i.g&&(a=i.g,i.g=i.g.next,i.g||(i.h=null),a.next=null),a}class Ft{constructor(){this.h=this.g=null}add(a,c){let d=en.get();d.set(a,c),this.h?this.h.next=d:this.g=d,this.h=d}}var en=new U(()=>new Ih,i=>i.reset());class Ih{constructor(){this.next=this.g=this.h=null}set(a,c){this.h=a,this.g=c,this.next=null}reset(){this.next=this.g=this.h=null}}let nn,rn=!1,Ri=new Ft,Sa=()=>{let i=l.Promise.resolve(void 0);nn=()=>{i.then(Th)}};var Th=()=>{for(var i;i=g();){try{i.h.call(i.g)}catch(c){E(c)}var a=en;a.j(i),100>a.h&&(a.h++,i.next=a.g,a.g=i)}rn=!1};function Xt(){this.s=this.s,this.C=this.C}Xt.prototype.s=!1,Xt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Xt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function lt(i,a){this.type=i,this.g=this.target=a,this.defaultPrevented=!1}lt.prototype.h=function(){this.defaultPrevented=!0};var Eh=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,a=Object.defineProperty({},"passive",{get:function(){i=!0}});try{let c=()=>{};l.addEventListener("test",c,a),l.removeEventListener("test",c,a)}catch{}return i}();function sn(i,a){if(lt.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var c=this.type=i.type,d=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=a,a=i.relatedTarget){if(Tt){t:{try{Z(a.nodeName);var I=!0;break t}catch{}I=!1}I||(a=null)}}else c=="mouseover"?a=i.fromElement:c=="mouseout"&&(a=i.toElement);this.relatedTarget=a,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:Ah[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&sn.aa.h.call(this)}}x(sn,lt);var Ah={2:"touch",3:"pen",4:"mouse"};sn.prototype.h=function(){sn.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var on="closure_listenable_"+(1e6*Math.random()|0),bh=0;function Sh(i,a,c,d,I){this.listener=i,this.proxy=null,this.src=a,this.type=c,this.capture=!!d,this.ha=I,this.key=++bh,this.da=this.fa=!1}function Jn(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function Yn(i){this.src=i,this.g={},this.h=0}Yn.prototype.add=function(i,a,c,d,I){var A=i.toString();i=this.g[A],i||(i=this.g[A]=[],this.h++);var D=Di(i,a,d,I);return-1<D?(a=i[D],c||(a.fa=!1)):(a=new Sh(a,this.src,A,!!d,I),a.fa=c,i.push(a)),a};function Ci(i,a){var c=a.type;if(c in i.g){var d=i.g[c],I=Array.prototype.indexOf.call(d,a,void 0),A;(A=0<=I)&&Array.prototype.splice.call(d,I,1),A&&(Jn(a),i.g[c].length==0&&(delete i.g[c],i.h--))}}function Di(i,a,c,d){for(var I=0;I<i.length;++I){var A=i[I];if(!A.da&&A.listener==a&&A.capture==!!c&&A.ha==d)return I}return-1}var Pi="closure_lm_"+(1e6*Math.random()|0),xi={};function Ra(i,a,c,d,I){if(d&&d.once)return Da(i,a,c,d,I);if(Array.isArray(a)){for(var A=0;A<a.length;A++)Ra(i,a[A],c,d,I);return null}return c=Oi(c),i&&i[on]?i.K(a,c,f(d)?!!d.capture:!!d,I):Ca(i,a,c,!1,d,I)}function Ca(i,a,c,d,I,A){if(!a)throw Error("Invalid event type");var D=f(I)?!!I.capture:!!I,H=ki(i);if(H||(i[Pi]=H=new Yn(i)),c=H.add(a,c,d,D,A),c.proxy)return c;if(d=Rh(),c.proxy=d,d.src=i,d.listener=c,i.addEventListener)Eh||(I=D),I===void 0&&(I=!1),i.addEventListener(a.toString(),d,I);else if(i.attachEvent)i.attachEvent(xa(a.toString()),d);else if(i.addListener&&i.removeListener)i.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return c}function Rh(){function i(c){return a.call(i.src,i.listener,c)}let a=Ch;return i}function Da(i,a,c,d,I){if(Array.isArray(a)){for(var A=0;A<a.length;A++)Da(i,a[A],c,d,I);return null}return c=Oi(c),i&&i[on]?i.L(a,c,f(d)?!!d.capture:!!d,I):Ca(i,a,c,!0,d,I)}function Pa(i,a,c,d,I){if(Array.isArray(a))for(var A=0;A<a.length;A++)Pa(i,a[A],c,d,I);else d=f(d)?!!d.capture:!!d,c=Oi(c),i&&i[on]?(i=i.i,a=String(a).toString(),a in i.g&&(A=i.g[a],c=Di(A,c,d,I),-1<c&&(Jn(A[c]),Array.prototype.splice.call(A,c,1),A.length==0&&(delete i.g[a],i.h--)))):i&&(i=ki(i))&&(a=i.g[a.toString()],i=-1,a&&(i=Di(a,c,d,I)),(c=-1<i?a[i]:null)&&Vi(c))}function Vi(i){if(typeof i!="number"&&i&&!i.da){var a=i.src;if(a&&a[on])Ci(a.i,i);else{var c=i.type,d=i.proxy;a.removeEventListener?a.removeEventListener(c,d,i.capture):a.detachEvent?a.detachEvent(xa(c),d):a.addListener&&a.removeListener&&a.removeListener(d),(c=ki(a))?(Ci(c,i),c.h==0&&(c.src=null,a[Pi]=null)):Jn(i)}}}function xa(i){return i in xi?xi[i]:xi[i]="on"+i}function Ch(i,a){if(i.da)i=!0;else{a=new sn(a,this);var c=i.listener,d=i.ha||i.src;i.fa&&Vi(i),i=c.call(d,a)}return i}function ki(i){return i=i[Pi],i instanceof Yn?i:null}var Ni="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oi(i){return typeof i=="function"?i:(i[Ni]||(i[Ni]=function(a){return i.handleEvent(a)}),i[Ni])}function ht(){Xt.call(this),this.i=new Yn(this),this.M=this,this.F=null}x(ht,Xt),ht.prototype[on]=!0,ht.prototype.removeEventListener=function(i,a,c,d){Pa(this,i,a,c,d)};function pt(i,a){var c,d=i.F;if(d)for(c=[];d;d=d.F)c.push(d);if(i=i.M,d=a.type||a,typeof a=="string")a=new lt(a,i);else if(a instanceof lt)a.target=a.target||i;else{var I=a;a=new lt(d,i),y(a,I)}if(I=!0,c)for(var A=c.length-1;0<=A;A--){var D=a.g=c[A];I=Xn(D,d,!0,a)&&I}if(D=a.g=i,I=Xn(D,d,!0,a)&&I,I=Xn(D,d,!1,a)&&I,c)for(A=0;A<c.length;A++)D=a.g=c[A],I=Xn(D,d,!1,a)&&I}ht.prototype.N=function(){if(ht.aa.N.call(this),this.i){var i=this.i,a;for(a in i.g){for(var c=i.g[a],d=0;d<c.length;d++)Jn(c[d]);delete i.g[a],i.h--}}this.F=null},ht.prototype.K=function(i,a,c,d){return this.i.add(String(i),a,!1,c,d)},ht.prototype.L=function(i,a,c,d){return this.i.add(String(i),a,!0,c,d)};function Xn(i,a,c,d){if(a=i.i.g[String(a)],!a)return!0;a=a.concat();for(var I=!0,A=0;A<a.length;++A){var D=a[A];if(D&&!D.da&&D.capture==c){var H=D.listener,ut=D.ha||D.src;D.fa&&Ci(i.i,D),I=H.call(ut,d)!==!1&&I}}return I&&!d.defaultPrevented}function Va(i,a,c){if(typeof i=="function")c&&(i=b(i,c));else if(i&&typeof i.handleEvent=="function")i=b(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(a)?-1:l.setTimeout(i,a||0)}function ka(i){i.g=Va(()=>{i.g=null,i.i&&(i.i=!1,ka(i))},i.l);let a=i.h;i.h=null,i.m.apply(null,a)}class Dh extends Xt{constructor(a,c){super(),this.m=a,this.l=c,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:ka(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function an(i){Xt.call(this),this.h=i,this.g={}}x(an,Xt);var Na=[];function Oa(i){J(i.g,function(a,c){this.g.hasOwnProperty(c)&&Vi(a)},i),i.g={}}an.prototype.N=function(){an.aa.N.call(this),Oa(this)},an.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fi=l.JSON.stringify,Ph=l.JSON.parse,xh=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function Mi(){}Mi.prototype.h=null;function Fa(i){return i.h||(i.h=i.i())}function Ma(){}var un={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Li(){lt.call(this,"d")}x(Li,lt);function Bi(){lt.call(this,"c")}x(Bi,lt);var ue={},La=null;function Zn(){return La=La||new ht}ue.La="serverreachability";function Ba(i){lt.call(this,ue.La,i)}x(Ba,lt);function cn(i){let a=Zn();pt(a,new Ba(a))}ue.STAT_EVENT="statevent";function qa(i,a){lt.call(this,ue.STAT_EVENT,i),this.stat=a}x(qa,lt);function _t(i){let a=Zn();pt(a,new qa(a,i))}ue.Ma="timingevent";function Ua(i,a){lt.call(this,ue.Ma,i),this.size=a}x(Ua,lt);function ln(i,a){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},a)}function hn(){this.g=!0}hn.prototype.xa=function(){this.g=!1};function Vh(i,a,c,d,I,A){i.info(function(){if(i.g)if(A)for(var D="",H=A.split("&"),ut=0;ut<H.length;ut++){var K=H[ut].split("=");if(1<K.length){var dt=K[0];K=K[1];var ft=dt.split("_");D=2<=ft.length&&ft[1]=="type"?D+(dt+"="+K+"&"):D+(dt+"=redacted&")}}else D=null;else D=A;return"XMLHTTP REQ ("+d+") [attempt "+I+"]: "+a+`
`+c+`
`+D})}function kh(i,a,c,d,I,A,D){i.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+I+"]: "+a+`
`+c+`
`+A+" "+D})}function Te(i,a,c,d){i.info(function(){return"XMLHTTP TEXT ("+a+"): "+Oh(i,c)+(d?" "+d:"")})}function Nh(i,a){i.info(function(){return"TIMEOUT: "+a})}hn.prototype.info=function(){};function Oh(i,a){if(!i.g)return a;if(!a)return null;try{var c=JSON.parse(a);if(c){for(i=0;i<c.length;i++)if(Array.isArray(c[i])){var d=c[i];if(!(2>d.length)){var I=d[1];if(Array.isArray(I)&&!(1>I.length)){var A=I[0];if(A!="noop"&&A!="stop"&&A!="close")for(var D=1;D<I.length;D++)I[D]=""}}}}return Fi(c)}catch{return a}}var tr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ga={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},qi;function er(){}x(er,Mi),er.prototype.g=function(){return new XMLHttpRequest},er.prototype.i=function(){return{}},qi=new er;function Zt(i,a,c,d){this.j=i,this.i=a,this.l=c,this.R=d||1,this.U=new an(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ja}function ja(){this.i=null,this.g="",this.h=!1}var za={},Ui={};function Gi(i,a,c){i.L=1,i.v=sr(Mt(a)),i.m=c,i.P=!0,$a(i,null)}function $a(i,a){i.F=Date.now(),nr(i),i.A=Mt(i.v);var c=i.A,d=i.R;Array.isArray(d)||(d=[String(d)]),su(c.i,"t",d),i.C=0,c=i.j.J,i.h=new ja,i.g=Eu(i.j,c?a:null,!i.m),0<i.O&&(i.M=new Dh(b(i.Y,i,i.g),i.O)),a=i.U,c=i.g,d=i.ca;var I="readystatechange";Array.isArray(I)||(I&&(Na[0]=I.toString()),I=Na);for(var A=0;A<I.length;A++){var D=Ra(c,I[A],d||a.handleEvent,!1,a.h||a);if(!D)break;a.g[D.key]=D}a=i.H?m(i.H):{},i.m?(i.u||(i.u="POST"),a["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,a)):(i.u="GET",i.g.ea(i.A,i.u,null,a)),cn(),Vh(i.i,i.u,i.A,i.l,i.R,i.m)}Zt.prototype.ca=function(i){i=i.target;let a=this.M;a&&Lt(i)==3?a.j():this.Y(i)},Zt.prototype.Y=function(i){try{if(i==this.g)t:{let ft=Lt(this.g);var a=this.g.Ba();let be=this.g.Z();if(!(3>ft)&&(ft!=3||this.g&&(this.h.h||this.g.oa()||du(this.g)))){this.J||ft!=4||a==7||(a==8||0>=be?cn(3):cn(2)),ji(this);var c=this.g.Z();this.X=c;e:if(Ka(this)){var d=du(this.g);i="";var I=d.length,A=Lt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ce(this),dn(this);var D="";break e}this.h.i=new l.TextDecoder}for(a=0;a<I;a++)this.h.h=!0,i+=this.h.i.decode(d[a],{stream:!(A&&a==I-1)});d.length=0,this.h.g+=i,this.C=0,D=this.h.g}else D=this.g.oa();if(this.o=c==200,kh(this.i,this.u,this.A,this.l,this.R,ft,c),this.o){if(this.T&&!this.K){e:{if(this.g){var H,ut=this.g;if((H=ut.g?ut.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(H)){var K=H;break e}}K=null}if(c=K)Te(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zi(this,c);else{this.o=!1,this.s=3,_t(12),ce(this),dn(this);break t}}if(this.P){c=!0;let bt;for(;!this.J&&this.C<D.length;)if(bt=Fh(this,D),bt==Ui){ft==4&&(this.s=4,_t(14),c=!1),Te(this.i,this.l,null,"[Incomplete Response]");break}else if(bt==za){this.s=4,_t(15),Te(this.i,this.l,D,"[Invalid Chunk]"),c=!1;break}else Te(this.i,this.l,bt,null),zi(this,bt);if(Ka(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ft!=4||D.length!=0||this.h.h||(this.s=1,_t(16),c=!1),this.o=this.o&&c,!c)Te(this.i,this.l,D,"[Invalid Chunked Response]"),ce(this),dn(this);else if(0<D.length&&!this.W){this.W=!0;var dt=this.j;dt.g==this&&dt.ba&&!dt.M&&(dt.j.info("Great, no buffering proxy detected. Bytes received: "+D.length),Ji(dt),dt.M=!0,_t(11))}}else Te(this.i,this.l,D,null),zi(this,D);ft==4&&ce(this),this.o&&!this.J&&(ft==4?vu(this.j,this):(this.o=!1,nr(this)))}else Zh(this.g),c==400&&0<D.indexOf("Unknown SID")?(this.s=3,_t(12)):(this.s=0,_t(13)),ce(this),dn(this)}}}catch{}finally{}};function Ka(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function Fh(i,a){var c=i.C,d=a.indexOf(`
`,c);return d==-1?Ui:(c=Number(a.substring(c,d)),isNaN(c)?za:(d+=1,d+c>a.length?Ui:(a=a.slice(d,d+c),i.C=d+c,a)))}Zt.prototype.cancel=function(){this.J=!0,ce(this)};function nr(i){i.S=Date.now()+i.I,Qa(i,i.I)}function Qa(i,a){if(i.B!=null)throw Error("WatchDog timer not null");i.B=ln(b(i.ba,i),a)}function ji(i){i.B&&(l.clearTimeout(i.B),i.B=null)}Zt.prototype.ba=function(){this.B=null;let i=Date.now();0<=i-this.S?(Nh(this.i,this.A),this.L!=2&&(cn(),_t(17)),ce(this),this.s=2,dn(this)):Qa(this,this.S-i)};function dn(i){i.j.G==0||i.J||vu(i.j,i)}function ce(i){ji(i);var a=i.M;a&&typeof a.ma=="function"&&a.ma(),i.M=null,Oa(i.U),i.g&&(a=i.g,i.g=null,a.abort(),a.ma())}function zi(i,a){try{var c=i.j;if(c.G!=0&&(c.g==i||$i(c.h,i))){if(!i.K&&$i(c.h,i)&&c.G==3){try{var d=c.Da.g.parse(a)}catch{d=null}if(Array.isArray(d)&&d.length==3){var I=d;if(I[0]==0){t:if(!c.u){if(c.g)if(c.g.F+3e3<i.F)lr(c),ur(c);else break t;Hi(c),_t(18)}}else c.za=I[1],0<c.za-c.T&&37500>I[2]&&c.F&&c.v==0&&!c.C&&(c.C=ln(b(c.Za,c),6e3));if(1>=Ja(c.h)&&c.ca){try{c.ca()}catch{}c.ca=void 0}}else he(c,11)}else if((i.K||c.g==i)&&lr(c),!$(a))for(I=c.Da.g.parse(a),a=0;a<I.length;a++){let K=I[a];if(c.T=K[0],K=K[1],c.G==2)if(K[0]=="c"){c.K=K[1],c.ia=K[2];let dt=K[3];dt!=null&&(c.la=dt,c.j.info("VER="+c.la));let ft=K[4];ft!=null&&(c.Aa=ft,c.j.info("SVER="+c.Aa));let be=K[5];be!=null&&typeof be=="number"&&0<be&&(d=1.5*be,c.L=d,c.j.info("backChannelRequestTimeoutMs_="+d)),d=c;let bt=i.g;if(bt){let dr=bt.g?bt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(dr){var A=d.h;A.g||dr.indexOf("spdy")==-1&&dr.indexOf("quic")==-1&&dr.indexOf("h2")==-1||(A.j=A.l,A.g=new Set,A.h&&(Ki(A,A.h),A.h=null))}if(d.D){let Yi=bt.g?bt.g.getResponseHeader("X-HTTP-Session-Id"):null;Yi&&(d.ya=Yi,Y(d.I,d.D,Yi))}}c.G=3,c.l&&c.l.ua(),c.ba&&(c.R=Date.now()-i.F,c.j.info("Handshake RTT: "+c.R+"ms")),d=c;var D=i;if(d.qa=Tu(d,d.J?d.ia:null,d.W),D.K){Ya(d.h,D);var H=D,ut=d.L;ut&&(H.I=ut),H.B&&(ji(H),nr(H)),d.g=D}else _u(d);0<c.i.length&&cr(c)}else K[0]!="stop"&&K[0]!="close"||he(c,7);else c.G==3&&(K[0]=="stop"||K[0]=="close"?K[0]=="stop"?he(c,7):Wi(c):K[0]!="noop"&&c.l&&c.l.ta(K),c.v=0)}}cn(4)}catch{}}var Mh=class{constructor(i,a){this.g=i,this.map=a}};function Wa(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ha(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Ja(i){return i.h?1:i.g?i.g.size:0}function $i(i,a){return i.h?i.h==a:i.g?i.g.has(a):!1}function Ki(i,a){i.g?i.g.add(a):i.h=a}function Ya(i,a){i.h&&i.h==a?i.h=null:i.g&&i.g.has(a)&&i.g.delete(a)}Wa.prototype.cancel=function(){if(this.i=Xa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let i of this.g.values())i.cancel();this.g.clear()}};function Xa(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let a=i.i;for(let c of i.g.values())a=a.concat(c.D);return a}return N(i.i)}function Lh(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(h(i)){for(var a=[],c=i.length,d=0;d<c;d++)a.push(i[d]);return a}a=[],c=0;for(d in i)a[c++]=i[d];return a}function Bh(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(h(i)||typeof i=="string"){var a=[];i=i.length;for(var c=0;c<i;c++)a.push(c);return a}a=[],c=0;for(let d in i)a[c++]=d;return a}}}function Za(i,a){if(i.forEach&&typeof i.forEach=="function")i.forEach(a,void 0);else if(h(i)||typeof i=="string")Array.prototype.forEach.call(i,a,void 0);else for(var c=Bh(i),d=Lh(i),I=d.length,A=0;A<I;A++)a.call(void 0,d[A],c&&c[A],i)}var tu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qh(i,a){if(i){i=i.split("&");for(var c=0;c<i.length;c++){var d=i[c].indexOf("="),I=null;if(0<=d){var A=i[c].substring(0,d);I=i[c].substring(d+1)}else A=i[c];a(A,I?decodeURIComponent(I.replace(/\+/g," ")):"")}}}function le(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof le){this.h=i.h,rr(this,i.j),this.o=i.o,this.g=i.g,ir(this,i.s),this.l=i.l;var a=i.i,c=new gn;c.i=a.i,a.g&&(c.g=new Map(a.g),c.h=a.h),eu(this,c),this.m=i.m}else i&&(a=String(i).match(tu))?(this.h=!1,rr(this,a[1]||"",!0),this.o=fn(a[2]||""),this.g=fn(a[3]||"",!0),ir(this,a[4]),this.l=fn(a[5]||"",!0),eu(this,a[6]||"",!0),this.m=fn(a[7]||"")):(this.h=!1,this.i=new gn(null,this.h))}le.prototype.toString=function(){var i=[],a=this.j;a&&i.push(mn(a,nu,!0),":");var c=this.g;return(c||a=="file")&&(i.push("//"),(a=this.o)&&i.push(mn(a,nu,!0),"@"),i.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.s,c!=null&&i.push(":",String(c))),(c=this.l)&&(this.g&&c.charAt(0)!="/"&&i.push("/"),i.push(mn(c,c.charAt(0)=="/"?jh:Gh,!0))),(c=this.i.toString())&&i.push("?",c),(c=this.m)&&i.push("#",mn(c,$h)),i.join("")};function Mt(i){return new le(i)}function rr(i,a,c){i.j=c?fn(a,!0):a,i.j&&(i.j=i.j.replace(/:$/,""))}function ir(i,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);i.s=a}else i.s=null}function eu(i,a,c){a instanceof gn?(i.i=a,Kh(i.i,i.h)):(c||(a=mn(a,zh)),i.i=new gn(a,i.h))}function Y(i,a,c){i.i.set(a,c)}function sr(i){return Y(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function fn(i,a){return i?a?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function mn(i,a,c){return typeof i=="string"?(i=encodeURI(i).replace(a,Uh),c&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Uh(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var nu=/[#\/\?@]/g,Gh=/[#\?:]/g,jh=/[#\?]/g,zh=/[#\?@]/g,$h=/#/g;function gn(i,a){this.h=this.g=null,this.i=i||null,this.j=!!a}function te(i){i.g||(i.g=new Map,i.h=0,i.i&&qh(i.i,function(a,c){i.add(decodeURIComponent(a.replace(/\+/g," ")),c)}))}r=gn.prototype,r.add=function(i,a){te(this),this.i=null,i=Ee(this,i);var c=this.g.get(i);return c||this.g.set(i,c=[]),c.push(a),this.h+=1,this};function ru(i,a){te(i),a=Ee(i,a),i.g.has(a)&&(i.i=null,i.h-=i.g.get(a).length,i.g.delete(a))}function iu(i,a){return te(i),a=Ee(i,a),i.g.has(a)}r.forEach=function(i,a){te(this),this.g.forEach(function(c,d){c.forEach(function(I){i.call(a,I,d,this)},this)},this)},r.na=function(){te(this);let i=Array.from(this.g.values()),a=Array.from(this.g.keys()),c=[];for(let d=0;d<a.length;d++){let I=i[d];for(let A=0;A<I.length;A++)c.push(a[d])}return c},r.V=function(i){te(this);let a=[];if(typeof i=="string")iu(this,i)&&(a=a.concat(this.g.get(Ee(this,i))));else{i=Array.from(this.g.values());for(let c=0;c<i.length;c++)a=a.concat(i[c])}return a},r.set=function(i,a){return te(this),this.i=null,i=Ee(this,i),iu(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[a]),this.h+=1,this},r.get=function(i,a){return i?(i=this.V(i),0<i.length?String(i[0]):a):a};function su(i,a,c){ru(i,a),0<c.length&&(i.i=null,i.g.set(Ee(i,a),N(c)),i.h+=c.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let i=[],a=Array.from(this.g.keys());for(var c=0;c<a.length;c++){var d=a[c];let A=encodeURIComponent(String(d)),D=this.V(d);for(d=0;d<D.length;d++){var I=A;D[d]!==""&&(I+="="+encodeURIComponent(String(D[d]))),i.push(I)}}return this.i=i.join("&")};function Ee(i,a){return a=String(a),i.j&&(a=a.toLowerCase()),a}function Kh(i,a){a&&!i.j&&(te(i),i.i=null,i.g.forEach(function(c,d){var I=d.toLowerCase();d!=I&&(ru(this,d),su(this,I,c))},i)),i.j=a}function Qh(i,a){let c=new hn;if(l.Image){let d=new Image;d.onload=C(ee,c,"TestLoadImage: loaded",!0,a,d),d.onerror=C(ee,c,"TestLoadImage: error",!1,a,d),d.onabort=C(ee,c,"TestLoadImage: abort",!1,a,d),d.ontimeout=C(ee,c,"TestLoadImage: timeout",!1,a,d),l.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=i}else a(!1)}function Wh(i,a){let c=new hn,d=new AbortController,I=setTimeout(()=>{d.abort(),ee(c,"TestPingServer: timeout",!1,a)},1e4);fetch(i,{signal:d.signal}).then(A=>{clearTimeout(I),A.ok?ee(c,"TestPingServer: ok",!0,a):ee(c,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(I),ee(c,"TestPingServer: error",!1,a)})}function ee(i,a,c,d,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),d(c)}catch{}}function Hh(){this.g=new xh}function Jh(i,a,c){let d=c||"";try{Za(i,function(I,A){let D=I;f(I)&&(D=Fi(I)),a.push(d+A+"="+encodeURIComponent(D))})}catch(I){throw a.push(d+"type="+encodeURIComponent("_badmap")),I}}function pn(i){this.l=i.Ub||null,this.j=i.eb||!1}x(pn,Mi),pn.prototype.g=function(){return new or(this.l,this.j)},pn.prototype.i=function(i){return function(){return i}}({});function or(i,a){ht.call(this),this.D=i,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(or,ht),r=or.prototype,r.open=function(i,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=a,this.readyState=1,yn(this)},r.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let a={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(a.body=i),(this.D||l).fetch(new Request(this.A,a)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,_n(this)),this.readyState=0},r.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,yn(this)),this.g&&(this.readyState=3,yn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ou(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function ou(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}r.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var a=i.value?i.value:new Uint8Array(0);(a=this.v.decode(a,{stream:!i.done}))&&(this.response=this.responseText+=a)}i.done?_n(this):yn(this),this.readyState==3&&ou(this)}},r.Ra=function(i){this.g&&(this.response=this.responseText=i,_n(this))},r.Qa=function(i){this.g&&(this.response=i,_n(this))},r.ga=function(){this.g&&_n(this)};function _n(i){i.readyState=4,i.l=null,i.j=null,i.v=null,yn(i)}r.setRequestHeader=function(i,a){this.u.append(i,a)},r.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let i=[],a=this.h.entries();for(var c=a.next();!c.done;)c=c.value,i.push(c[0]+": "+c[1]),c=a.next();return i.join(`\r
`)};function yn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(or.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function au(i){let a="";return J(i,function(c,d){a+=d,a+=":",a+=c,a+=`\r
`}),a}function Qi(i,a,c){t:{for(d in c){var d=!1;break t}d=!0}d||(c=au(c),typeof i=="string"?c!=null&&encodeURIComponent(String(c)):Y(i,a,c))}function tt(i){ht.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(tt,ht);var Yh=/^https?$/i,Xh=["POST","PUT"];r=tt.prototype,r.Ha=function(i){this.J=i},r.ea=function(i,a,c,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);a=a?a.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():qi.g(),this.v=this.o?Fa(this.o):Fa(qi),this.g.onreadystatechange=b(this.Ea,this);try{this.B=!0,this.g.open(a,String(i),!0),this.B=!1}catch(A){uu(this,A);return}if(i=c||"",c=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var I in d)c.set(I,d[I]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let A of d.keys())c.set(A,d.get(A));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(c.keys()).find(A=>A.toLowerCase()=="content-type"),I=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Xh,a,void 0))||d||I||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[A,D]of c)this.g.setRequestHeader(A,D);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{hu(this),this.u=!0,this.g.send(i),this.u=!1}catch(A){uu(this,A)}};function uu(i,a){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=a,i.m=5,cu(i),ar(i)}function cu(i){i.A||(i.A=!0,pt(i,"complete"),pt(i,"error"))}r.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,pt(this,"complete"),pt(this,"abort"),ar(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ar(this,!0)),tt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?lu(this):this.bb())},r.bb=function(){lu(this)};function lu(i){if(i.h&&typeof u<"u"&&(!i.v[1]||Lt(i)!=4||i.Z()!=2)){if(i.u&&Lt(i)==4)Va(i.Ea,0,i);else if(pt(i,"readystatechange"),Lt(i)==4){i.h=!1;try{let D=i.Z();t:switch(D){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break t;default:a=!1}var c;if(!(c=a)){var d;if(d=D===0){var I=String(i.D).match(tu)[1]||null;!I&&l.self&&l.self.location&&(I=l.self.location.protocol.slice(0,-1)),d=!Yh.test(I?I.toLowerCase():"")}c=d}if(c)pt(i,"complete"),pt(i,"success");else{i.m=6;try{var A=2<Lt(i)?i.g.statusText:""}catch{A=""}i.l=A+" ["+i.Z()+"]",cu(i)}}finally{ar(i)}}}}function ar(i,a){if(i.g){hu(i);let c=i.g,d=i.v[0]?()=>{}:null;i.g=null,i.v=null,a||pt(i,"ready");try{c.onreadystatechange=d}catch{}}}function hu(i){i.I&&(l.clearTimeout(i.I),i.I=null)}r.isActive=function(){return!!this.g};function Lt(i){return i.g?i.g.readyState:0}r.Z=function(){try{return 2<Lt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(i){if(this.g){var a=this.g.responseText;return i&&a.indexOf(i)==0&&(a=a.substring(i.length)),Ph(a)}};function du(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Zh(i){let a={};i=(i.g&&2<=Lt(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<i.length;d++){if($(i[d]))continue;var c=v(i[d]);let I=c[0];if(c=c[1],typeof c!="string")continue;c=c.trim();let A=a[I]||[];a[I]=A,A.push(c)}w(a,function(d){return d.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function vn(i,a,c){return c&&c.internalChannelParams&&c.internalChannelParams[i]||a}function fu(i){this.Aa=0,this.i=[],this.j=new hn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=vn("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=vn("baseRetryDelayMs",5e3,i),this.cb=vn("retryDelaySeedMs",1e4,i),this.Wa=vn("forwardChannelMaxRetries",2,i),this.wa=vn("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new Wa(i&&i.concurrentRequestLimit),this.Da=new Hh,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=fu.prototype,r.la=8,r.G=1,r.connect=function(i,a,c,d){_t(0),this.W=i,this.H=a||{},c&&d!==void 0&&(this.H.OSID=c,this.H.OAID=d),this.F=this.X,this.I=Tu(this,null,this.W),cr(this)};function Wi(i){if(mu(i),i.G==3){var a=i.U++,c=Mt(i.I);if(Y(c,"SID",i.K),Y(c,"RID",a),Y(c,"TYPE","terminate"),wn(i,c),a=new Zt(i,i.j,a),a.L=2,a.v=sr(Mt(c)),c=!1,l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(a.v.toString(),"")}catch{}!c&&l.Image&&(new Image().src=a.v,c=!0),c||(a.g=Eu(a.j,null),a.g.ea(a.v)),a.F=Date.now(),nr(a)}Iu(i)}function ur(i){i.g&&(Ji(i),i.g.cancel(),i.g=null)}function mu(i){ur(i),i.u&&(l.clearTimeout(i.u),i.u=null),lr(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function cr(i){if(!Ha(i.h)&&!i.s){i.s=!0;var a=i.Ga;nn||Sa(),rn||(nn(),rn=!0),Ri.add(a,i),i.B=0}}function td(i,a){return Ja(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=a.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=ln(b(i.Ga,i,a),wu(i,i.B)),i.B++,!0)}r.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;let I=new Zt(this,this.j,i),A=this.o;if(this.S&&(A?(A=m(A),y(A,this.S)):A=this.S),this.m!==null||this.O||(I.H=A,A=null),this.P)t:{for(var a=0,c=0;c<this.i.length;c++){e:{var d=this.i[c];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break e}d=void 0}if(d===void 0)break;if(a+=d,4096<a){a=c;break t}if(a===4096||c===this.i.length-1){a=c+1;break t}}a=1e3}else a=1e3;a=pu(this,I,a),c=Mt(this.I),Y(c,"RID",i),Y(c,"CVER",22),this.D&&Y(c,"X-HTTP-Session-Id",this.D),wn(this,c),A&&(this.O?a="headers="+encodeURIComponent(String(au(A)))+"&"+a:this.m&&Qi(c,this.m,A)),Ki(this.h,I),this.Ua&&Y(c,"TYPE","init"),this.P?(Y(c,"$req",a),Y(c,"SID","null"),I.T=!0,Gi(I,c,null)):Gi(I,c,a),this.G=2}}else this.G==3&&(i?gu(this,i):this.i.length==0||Ha(this.h)||gu(this))};function gu(i,a){var c;a?c=a.l:c=i.U++;let d=Mt(i.I);Y(d,"SID",i.K),Y(d,"RID",c),Y(d,"AID",i.T),wn(i,d),i.m&&i.o&&Qi(d,i.m,i.o),c=new Zt(i,i.j,c,i.B+1),i.m===null&&(c.H=i.o),a&&(i.i=a.D.concat(i.i)),a=pu(i,c,1e3),c.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),Ki(i.h,c),Gi(c,d,a)}function wn(i,a){i.H&&J(i.H,function(c,d){Y(a,d,c)}),i.l&&Za({},function(c,d){Y(a,d,c)})}function pu(i,a,c){c=Math.min(i.i.length,c);var d=i.l?b(i.l.Na,i.l,i):null;t:{var I=i.i;let A=-1;for(;;){let D=["count="+c];A==-1?0<c?(A=I[0].g,D.push("ofs="+A)):A=0:D.push("ofs="+A);let H=!0;for(let ut=0;ut<c;ut++){let K=I[ut].g,dt=I[ut].map;if(K-=A,0>K)A=Math.max(0,I[ut].g-100),H=!1;else try{Jh(dt,D,"req"+K+"_")}catch{d&&d(dt)}}if(H){d=D.join("&");break t}}}return i=i.i.splice(0,c),a.D=i,d}function _u(i){if(!i.g&&!i.u){i.Y=1;var a=i.Fa;nn||Sa(),rn||(nn(),rn=!0),Ri.add(a,i),i.v=0}}function Hi(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=ln(b(i.Fa,i),wu(i,i.v)),i.v++,!0)}r.Fa=function(){if(this.u=null,yu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=ln(b(this.ab,this),i)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,_t(10),ur(this),yu(this))};function Ji(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function yu(i){i.g=new Zt(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var a=Mt(i.qa);Y(a,"RID","rpc"),Y(a,"SID",i.K),Y(a,"AID",i.T),Y(a,"CI",i.F?"0":"1"),!i.F&&i.ja&&Y(a,"TO",i.ja),Y(a,"TYPE","xmlhttp"),wn(i,a),i.m&&i.o&&Qi(a,i.m,i.o),i.L&&(i.g.I=i.L);var c=i.g;i=i.ia,c.L=1,c.v=sr(Mt(a)),c.m=null,c.P=!0,$a(c,i)}r.Za=function(){this.C!=null&&(this.C=null,ur(this),Hi(this),_t(19))};function lr(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function vu(i,a){var c=null;if(i.g==a){lr(i),Ji(i),i.g=null;var d=2}else if($i(i.h,a))c=a.D,Ya(i.h,a),d=1;else return;if(i.G!=0){if(a.o)if(d==1){c=a.m?a.m.length:0,a=Date.now()-a.F;var I=i.B;d=Zn(),pt(d,new Ua(d,c)),cr(i)}else _u(i);else if(I=a.s,I==3||I==0&&0<a.X||!(d==1&&td(i,a)||d==2&&Hi(i)))switch(c&&0<c.length&&(a=i.h,a.i=a.i.concat(c)),I){case 1:he(i,5);break;case 4:he(i,10);break;case 3:he(i,6);break;default:he(i,2)}}}function wu(i,a){let c=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(c*=2),c*a}function he(i,a){if(i.j.info("Error code "+a),a==2){var c=b(i.fb,i),d=i.Xa;let I=!d;d=new le(d||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||rr(d,"https"),sr(d),I?Qh(d.toString(),c):Wh(d.toString(),c)}else _t(2);i.G=0,i.l&&i.l.sa(a),Iu(i),mu(i)}r.fb=function(i){i?(this.j.info("Successfully pinged google.com"),_t(2)):(this.j.info("Failed to ping google.com"),_t(1))};function Iu(i){if(i.G=0,i.ka=[],i.l){let a=Xa(i.h);(a.length!=0||i.i.length!=0)&&(P(i.ka,a),P(i.ka,i.i),i.h.i.length=0,N(i.i),i.i.length=0),i.l.ra()}}function Tu(i,a,c){var d=c instanceof le?Mt(c):new le(c);if(d.g!="")a&&(d.g=a+"."+d.g),ir(d,d.s);else{var I=l.location;d=I.protocol,a=a?a+"."+I.hostname:I.hostname,I=+I.port;var A=new le(null);d&&rr(A,d),a&&(A.g=a),I&&ir(A,I),c&&(A.l=c),d=A}return c=i.D,a=i.ya,c&&a&&Y(d,c,a),Y(d,"VER",i.la),wn(i,d),d}function Eu(i,a,c){if(a&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return a=i.Ca&&!i.pa?new tt(new pn({eb:c})):new tt(i.pa),a.Ha(i.J),a}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Au(){}r=Au.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function hr(){}hr.prototype.g=function(i,a){return new vt(i,a)};function vt(i,a){ht.call(this),this.g=new fu(a),this.l=i,this.h=a&&a.messageUrlParams||null,i=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(i?i["X-WebChannel-Content-Type"]=a.messageContentType:i={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.va&&(i?i["X-WebChannel-Client-Profile"]=a.va:i={"X-WebChannel-Client-Profile":a.va}),this.g.S=i,(i=a&&a.Sb)&&!$(i)&&(this.g.m=i),this.v=a&&a.supportsCrossDomainXhr||!1,this.u=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!$(a)&&(this.g.D=a,i=this.h,i!==null&&a in i&&(i=this.h,a in i&&delete i[a])),this.j=new Ae(this)}x(vt,ht),vt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},vt.prototype.close=function(){Wi(this.g)},vt.prototype.o=function(i){var a=this.g;if(typeof i=="string"){var c={};c.__data__=i,i=c}else this.u&&(c={},c.__data__=Fi(i),i=c);a.i.push(new Mh(a.Ya++,i)),a.G==3&&cr(a)},vt.prototype.N=function(){this.g.l=null,delete this.j,Wi(this.g),delete this.g,vt.aa.N.call(this)};function bu(i){Li.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var a=i.__sm__;if(a){t:{for(let c in a){i=c;break t}i=void 0}(this.i=i)&&(i=this.i,a=a!==null&&i in a?a[i]:void 0),this.data=a}else this.data=i}x(bu,Li);function Su(){Bi.call(this),this.status=1}x(Su,Bi);function Ae(i){this.g=i}x(Ae,Au),Ae.prototype.ua=function(){pt(this.g,"a")},Ae.prototype.ta=function(i){pt(this.g,new bu(i))},Ae.prototype.sa=function(i){pt(this.g,new Su)},Ae.prototype.ra=function(){pt(this.g,"b")},hr.prototype.createWebChannel=hr.prototype.g,vt.prototype.send=vt.prototype.o,vt.prototype.open=vt.prototype.m,vt.prototype.close=vt.prototype.close,gs=jt.createWebChannelTransport=function(){return new hr},ms=jt.getStatEventTarget=function(){return Zn()},fs=jt.Event=ue,Vr=jt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},tr.NO_ERROR=0,tr.TIMEOUT=8,tr.HTTP_ERROR=6,Dn=jt.ErrorCode=tr,Ga.COMPLETE="complete",ds=jt.EventType=Ga,Ma.EventType=un,un.OPEN="a",un.CLOSE="b",un.ERROR="c",un.MESSAGE="d",ht.prototype.listen=ht.prototype.K,De=jt.WebChannel=Ma,gd=jt.FetchXmlHttpFactory=pn,tt.prototype.listenOnce=tt.prototype.L,tt.prototype.getLastError=tt.prototype.Ka,tt.prototype.getLastErrorCode=tt.prototype.Ba,tt.prototype.getStatus=tt.prototype.Z,tt.prototype.getResponseJson=tt.prototype.Oa,tt.prototype.getResponseText=tt.prototype.oa,tt.prototype.send=tt.prototype.ea,tt.prototype.setWithCredentials=tt.prototype.Ha,hs=jt.XhrIo=tt}).apply(typeof xr<"u"?xr:typeof self<"u"?self:typeof window<"u"?window:{});var Dc="@firebase/firestore";var ot=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};ot.UNAUTHENTICATED=new ot(null),ot.GOOGLE_CREDENTIALS=new ot("google-credentials-uid"),ot.FIRST_PARTY=new ot("first-party-uid"),ot.MOCK_USER=new ot("mock-user");var Ye="11.2.0";var pe=new ac("@firebase/firestore");function Pe(){return pe.logLevel}function k(r,...t){if(pe.logLevel<=Dt.DEBUG){let e=t.map(ea);pe.debug(`Firestore (${Ye}): ${r}`,...e)}}function Qt(r,...t){if(pe.logLevel<=Dt.ERROR){let e=t.map(ea);pe.error(`Firestore (${Ye}): ${r}`,...e)}}function Me(r,...t){if(pe.logLevel<=Dt.WARN){let e=t.map(ea);pe.warn(`Firestore (${Ye}): ${r}`,...e)}}function ea(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function M(r="Unexpected state"){let t=`FIRESTORE (${Ye}) INTERNAL ASSERTION FAILED: `+r;throw Qt(t),new Error(t)}function W(r,t){r||M()}function L(r,t){return r}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends sc{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var zt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Br=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},ws=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ot.UNAUTHENTICATED))}shutdown(){}},Is=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ts=class{constructor(t){this.t=t,this.currentUser=ot.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){W(this.o===void 0);let n=this.i,s=h=>this.i!==n?(n=this.i,e(h)):Promise.resolve(),o=new zt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new zt,t.enqueueRetryable(()=>s(this.currentUser))};let u=()=>{let h=o;t.enqueueRetryable(()=>V(this,null,function*(){yield h.promise,yield s(this.currentUser)}))},l=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new zt)}},0),u()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(W(typeof n.accessToken=="string"),new Br(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return W(t===null||typeof t=="string"),new ot(t)}},Es=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=ot.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},As=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Es(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(ot.FIRST_PARTY))}shutdown(){}invalidateToken(){}},bs=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ss=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){W(this.o===void 0);let n=o=>{o.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let u=o.token!==this.R;return this.R=o.token,k("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>n(o))};let s=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){let o=this.A.getImmediate({optional:!0});o?s(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(W(typeof e.token=="string"),this.R=e.token,new bs(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function pd(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var qr=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";for(;n.length<20;){let s=pd(40);for(let o=0;o<s.length;++o)n.length<20&&s[o]<e&&(n+=t.charAt(s[o]%t.length))}return n}};function G(r,t){return r<t?-1:r>t?1:0}function Le(r,t,e){return r.length===t.length&&r.every((n,s)=>e(n,t[s]))}var ct=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new O(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new O(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new O(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?G(this.nanoseconds,t.nanoseconds):G(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var B=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new ct(0,0))}static max(){return new r(new ct(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ur=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&M(),n===void 0?n=t.length-e:n>t.length-e&&M(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let s=0;s<n;s++){let o=r.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return Math.sign(t.length-e.length)}static compareSegments(t,e){let n=r.isNumericId(t),s=r.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?r.extractNumericId(t).compare(r.extractNumericId(e)):t<e?-1:t>e?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Gt.fromString(t.substring(4,t.length-2))}},et=class r extends Ur{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new O(R.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(s=>s.length>0))}return new r(e)}static emptyPath(){return new r([])}},_d=/^[_a-zA-Z][_a-zA-Z0-9]*$/,It=class r extends Ur{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return _d.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(t){let e=[],n="",s=0,o=()=>{if(n.length===0)throw new O(R.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},u=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new O(R.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new O(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=h,s+=2}else l==="`"?(u=!u,s++):l!=="."||u?(n+=l,s++):(o(),s++)}if(o(),u)throw new O(R.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var F=class r{constructor(t){this.path=t}static fromPath(t){return new r(et.fromString(t))}static fromName(t){return new r(et.fromString(t).popFirst(5))}static empty(){return new r(et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&et.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return et.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new et(t.slice()))}};var Rs=class{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}};Rs.UNKNOWN_ID=-1;function yd(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=B.fromTimestamp(n===1e9?new ct(e+1,0):new ct(e,n));return new _e(s,F.empty(),t)}function vd(r){return new _e(r.readTime,r.key,-1)}var _e=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(B.min(),F.empty(),-1)}static max(){return new r(B.max(),F.empty(),-1)}};function wd(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=F.comparator(r.documentKey,t.documentKey),e!==0?e:G(r.largestBatchId,t.largestBatchId))}var Id="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Cs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Xe(r){return V(this,null,function*(){if(r.code!==R.FAILED_PRECONDITION||r.message!==Id)throw r;k("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&M(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(n,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let s=0,o=0,u=!1;t.forEach(l=>{++s,l.next(()=>{++o,u&&o===s&&e()},h=>n(h))}),u=!0,o===s&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(s=>s?r.resolve(s):n());return e}static forEach(t,e){let n=[];return t.forEach((s,o)=>{n.push(e.call(this,s,o))}),this.waitFor(n)}static mapArray(t,e){return new r((n,s)=>{let o=t.length,u=new Array(o),l=0;for(let h=0;h<o;h++){let f=h;e(t[f]).next(p=>{u[f]=p,++l,l===o&&n(u)},p=>s(p))}})}static doWhile(t,e){return new r((n,s)=>{let o=()=>{t()===!0?e().next(()=>{o()},s):n()};o()})}};function Td(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Ze(r){return r.name==="IndexedDbTransactionError"}var na=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return r.oe=-1,r})();function yi(r){return r==null}function On(r){return r===0&&1/r==-1/0}function Ed(r){return typeof r=="number"&&Number.isInteger(r)&&!On(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Ad(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Pc(t)),t=bd(r.get(e),t);return Pc(t)}function bd(r,t){let e=t,n=r.length;for(let s=0;s<n;s++){let o=r.charAt(s);switch(o){case"\0":e+="";break;case"":e+="";break;default:e+=o}}return e}function Pc(r){return r+""}var Sd=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ag=[...Sd,"documentOverlays"],Rd=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Cd=Rd,Dd=[...Cd,"indexConfiguration","indexState","indexEntries"];var bg=[...Dd,"globals"];function xc(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function ae(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function cl(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var nt=class r{constructor(t,e){this.comparator=t,this.root=e||Pt.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Pt.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Pt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ne(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ne(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ne(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ne(this.root,t,this.comparator,!0)}},Ne=class{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?n(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Pt=class r{constructor(t,e,n,s,o){this.key=t,this.value=e,this.color=n??r.RED,this.left=s??r.EMPTY,this.right=o??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,o){return new r(t??this.key,e??this.value,n??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this,o=n(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,n),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return r.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw M();let t=this.left.check();if(t!==this.right.check())throw M();return t+(this.isRed()?0:1)}};Pt.EMPTY=null,Pt.RED=!0,Pt.BLACK=!1;Pt.EMPTY=new class{constructor(){this.size=0}get key(){throw M()}get value(){throw M()}get color(){throw M()}get left(){throw M()}get right(){throw M()}copy(t,e,n,s,o){return this}insert(t,e,n){return new Pt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var at=class r{constructor(t){this.comparator=t,this.data=new nt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Gr(this.data.getIterator())}getIteratorFrom(t){return new Gr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=n.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Gr=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var At=class r{constructor(t){this.fields=t,t.sort(It.comparator)}static empty(){return new r([])}unionWith(t){let e=new at(It.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Le(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var jr=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var gt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new jr("Invalid base64 string: "+o):o}}(t);return new r(e)}static fromUint8Array(t){let e=function(s){let o="";for(let u=0;u<s.length;++u)o+=String.fromCharCode(s[u]);return o}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return G(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};gt.EMPTY_BYTE_STRING=new gt("");var Pd=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wt(r){if(W(!!r),typeof r=="string"){let t=0,e=Pd.exec(r);if(W(!!e),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:X(r.seconds),nanos:X(r.nanos)}}function X(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Ht(r){return typeof r=="string"?gt.fromBase64String(r):gt.fromUint8Array(r)}function ra(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function vi(r){let t=r.mapValue.fields.__previous_value__;return ra(t)?vi(t):t}function Fn(r){let t=Wt(r.mapValue.fields.__local_write_time__.timestampValue);return new ct(t.seconds,t.nanos)}var Ds=class{constructor(t,e,n,s,o,u,l,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f}},zr=class r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var kr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function ie(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?ra(r)?4:hl(r)?9007199254740991:ll(r)?10:11:M()}function kt(r,t){if(r===t)return!0;let e=ie(r);if(e!==ie(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Fn(r).isEqual(Fn(t));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;let u=Wt(s.timestampValue),l=Wt(o.timestampValue);return u.seconds===l.seconds&&u.nanos===l.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(s,o){return Ht(s.bytesValue).isEqual(Ht(o.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(s,o){return X(s.geoPointValue.latitude)===X(o.geoPointValue.latitude)&&X(s.geoPointValue.longitude)===X(o.geoPointValue.longitude)}(r,t);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return X(s.integerValue)===X(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){let u=X(s.doubleValue),l=X(o.doubleValue);return u===l?On(u)===On(l):isNaN(u)&&isNaN(l)}return!1}(r,t);case 9:return Le(r.arrayValue.values||[],t.arrayValue.values||[],kt);case 10:case 11:return function(s,o){let u=s.mapValue.fields||{},l=o.mapValue.fields||{};if(xc(u)!==xc(l))return!1;for(let h in u)if(u.hasOwnProperty(h)&&(l[h]===void 0||!kt(u[h],l[h])))return!1;return!0}(r,t);default:return M()}}function Mn(r,t){return(r.values||[]).find(e=>kt(e,t))!==void 0}function Be(r,t){if(r===t)return 0;let e=ie(r),n=ie(t);if(e!==n)return G(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return G(r.booleanValue,t.booleanValue);case 2:return function(o,u){let l=X(o.integerValue||o.doubleValue),h=X(u.integerValue||u.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1}(r,t);case 3:return Vc(r.timestampValue,t.timestampValue);case 4:return Vc(Fn(r),Fn(t));case 5:return G(r.stringValue,t.stringValue);case 6:return function(o,u){let l=Ht(o),h=Ht(u);return l.compareTo(h)}(r.bytesValue,t.bytesValue);case 7:return function(o,u){let l=o.split("/"),h=u.split("/");for(let f=0;f<l.length&&f<h.length;f++){let p=G(l[f],h[f]);if(p!==0)return p}return G(l.length,h.length)}(r.referenceValue,t.referenceValue);case 8:return function(o,u){let l=G(X(o.latitude),X(u.latitude));return l!==0?l:G(X(o.longitude),X(u.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return kc(r.arrayValue,t.arrayValue);case 10:return function(o,u){var l,h,f,p;let T=o.fields||{},b=u.fields||{},C=(l=T.value)===null||l===void 0?void 0:l.arrayValue,x=(h=b.value)===null||h===void 0?void 0:h.arrayValue,N=G(((f=C?.values)===null||f===void 0?void 0:f.length)||0,((p=x?.values)===null||p===void 0?void 0:p.length)||0);return N!==0?N:kc(C,x)}(r.mapValue,t.mapValue);case 11:return function(o,u){if(o===kr.mapValue&&u===kr.mapValue)return 0;if(o===kr.mapValue)return 1;if(u===kr.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),f=u.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let T=0;T<h.length&&T<p.length;++T){let b=G(h[T],p[T]);if(b!==0)return b;let C=Be(l[h[T]],f[p[T]]);if(C!==0)return C}return G(h.length,p.length)}(r.mapValue,t.mapValue);default:throw M()}}function Vc(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return G(r,t);let e=Wt(r),n=Wt(t),s=G(e.seconds,n.seconds);return s!==0?s:G(e.nanos,n.nanos)}function kc(r,t){let e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){let o=Be(e[s],n[s]);if(o)return o}return G(e.length,n.length)}function qe(r){return Ps(r)}function Ps(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=Wt(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return Ht(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return F.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",s=!0;for(let o of e.values||[])s?s=!1:n+=",",n+=Ps(o);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),s="{",o=!0;for(let u of n)o?o=!1:s+=",",s+=`${u}:${Ps(e.fields[u])}`;return s+"}"}(r.mapValue):M()}function Fr(r){switch(ie(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=vi(r);return t?16+Fr(t):16;case 5:return 2*r.stringValue.length;case 6:return Ht(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((s,o)=>s+Fr(o),0)}(r.arrayValue);case 10:case 11:return function(n){let s=0;return ae(n.fields,(o,u)=>{s+=o.length+Fr(u)}),s}(r.mapValue);default:throw M()}}function xs(r){return!!r&&"integerValue"in r}function ia(r){return!!r&&"arrayValue"in r}function Nc(r){return!!r&&"nullValue"in r}function Oc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Mr(r){return!!r&&"mapValue"in r}function ll(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function xn(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return ae(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=xn(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=xn(r.arrayValue.values[e]);return t}return Object.assign({},r)}function hl(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var wt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Mr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=xn(e)}setAll(t){let e=It.emptyPath(),n={},s=[];t.forEach((u,l)=>{if(!e.isImmediateParentOf(l)){let h=this.getFieldsMap(e);this.applyChanges(h,n,s),n={},s=[],e=l.popLast()}u?n[l.lastSegment()]=xn(u):s.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,n,s)}delete(t){let e=this.field(t.popLast());Mr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return kt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Mr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){ae(e,(s,o)=>t[s]=o);for(let s of n)delete t[s]}clone(){return new r(xn(this.value))}};function dl(r){let t=[];return ae(r.fields,(e,n)=>{let s=new It([e]);if(Mr(n)){let o=dl(n.mapValue).fields;if(o.length===0)t.push(s);else for(let u of o)t.push(s.child(u))}else t.push(s)}),new At(t)}var St=class r{constructor(t,e,n,s,o,u,l){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=o,this.data=u,this.documentState=l}static newInvalidDocument(t){return new r(t,0,B.min(),B.min(),B.min(),wt.empty(),0)}static newFoundDocument(t,e,n,s){return new r(t,1,e,B.min(),n,s,0)}static newNoDocument(t,e){return new r(t,2,e,B.min(),B.min(),wt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,B.min(),B.min(),wt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=wt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=wt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Ue=class{constructor(t,e){this.position=t,this.inclusive=e}};function Fc(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){let o=t[s],u=r.position[s];if(o.field.isKeyField()?n=F.comparator(F.fromName(u.referenceValue),e.key):n=Be(u,e.data.field(o.field)),o.dir==="desc"&&(n*=-1),n!==0)break}return n}function Mc(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!kt(r.position[e],t.position[e]))return!1;return!0}var Ge=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function xd(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var $r=class{},st=class r extends $r{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new ks(t,e,n):e==="array-contains"?new Fs(t,n):e==="in"?new Ms(t,n):e==="not-in"?new Ls(t,n):e==="array-contains-any"?new Bs(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Ns(t,n):new Os(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Be(e,this.value)):e!==null&&ie(this.value)===ie(e)&&this.matchesComparison(Be(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return M()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Nt=class r extends $r{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new r(t,e)}matches(t){return fl(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function fl(r){return r.op==="and"}function ml(r){return Vd(r)&&fl(r)}function Vd(r){for(let t of r.filters)if(t instanceof Nt)return!1;return!0}function Vs(r){if(r instanceof st)return r.field.canonicalString()+r.op.toString()+qe(r.value);if(ml(r))return r.filters.map(t=>Vs(t)).join(",");{let t=r.filters.map(e=>Vs(e)).join(",");return`${r.op}(${t})`}}function gl(r,t){return r instanceof st?function(n,s){return s instanceof st&&n.op===s.op&&n.field.isEqual(s.field)&&kt(n.value,s.value)}(r,t):r instanceof Nt?function(n,s){return s instanceof Nt&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((o,u,l)=>o&&gl(u,s.filters[l]),!0):!1}(r,t):void M()}function pl(r){return r instanceof st?function(e){return`${e.field.canonicalString()} ${e.op} ${qe(e.value)}`}(r):r instanceof Nt?function(e){return e.op.toString()+" {"+e.getFilters().map(pl).join(" ,")+"}"}(r):"Filter"}var ks=class extends st{constructor(t,e,n){super(t,e,n),this.key=F.fromName(n.referenceValue)}matches(t){let e=F.comparator(t.key,this.key);return this.matchesComparison(e)}},Ns=class extends st{constructor(t,e){super(t,"in",e),this.keys=_l("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Os=class extends st{constructor(t,e){super(t,"not-in",e),this.keys=_l("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function _l(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>F.fromName(n.referenceValue))}var Fs=class extends st{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return ia(e)&&Mn(e.arrayValue,this.value)}},Ms=class extends st{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Mn(this.value.arrayValue,e)}},Ls=class extends st{constructor(t,e){super(t,"not-in",e)}matches(t){if(Mn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Mn(this.value.arrayValue,e)}},Bs=class extends st{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!ia(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>Mn(this.value.arrayValue,n))}};var qs=class{constructor(t,e=null,n=[],s=[],o=null,u=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=o,this.startAt=u,this.endAt=l,this.ue=null}};function Lc(r,t=null,e=[],n=[],s=null,o=null,u=null){return new qs(r,t,e,n,s,o,u)}function sa(r){let t=L(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>Vs(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(o){return o.field.canonicalString()+o.dir}(n)).join(","),yi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>qe(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>qe(n)).join(",")),t.ue=e}return t.ue}function oa(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!xd(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!gl(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Mc(r.startAt,t.startAt)&&Mc(r.endAt,t.endAt)}function Us(r){return F.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}var je=class{constructor(t,e=null,n=[],s=[],o=null,u="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=o,this.limitType=u,this.startAt=l,this.endAt=h,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function kd(r,t,e,n,s,o,u,l){return new je(r,t,e,n,s,o,u,l)}function aa(r){return new je(r)}function Bc(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Nd(r){return r.collectionGroup!==null}function Vn(r){let t=L(r);if(t.ce===null){t.ce=[];let e=new Set;for(let o of t.explicitOrderBy)t.ce.push(o),e.add(o.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(u){let l=new at(It.comparator);return u.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.ce.push(new Ge(o,n))}),e.has(It.keyField().canonicalString())||t.ce.push(new Ge(It.keyField(),n))}return t.ce}function xt(r){let t=L(r);return t.le||(t.le=Od(t,Vn(r))),t.le}function Od(r,t){if(r.limitType==="F")return Lc(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(s=>{let o=s.dir==="desc"?"asc":"desc";return new Ge(s.field,o)});let e=r.endAt?new Ue(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Ue(r.startAt.position,r.startAt.inclusive):null;return Lc(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Gs(r,t,e){return new je(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function wi(r,t){return oa(xt(r),xt(t))&&r.limitType===t.limitType}function yl(r){return`${sa(xt(r))}|lt:${r.limitType}`}function xe(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>pl(s)).join(", ")}]`),yi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>function(u){return`${u.field.canonicalString()} (${u.dir})`}(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>qe(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>qe(s)).join(",")),`Target(${n})`}(xt(r))}; limitType=${r.limitType})`}function Ii(r,t){return t.isFoundDocument()&&function(n,s){let o=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):F.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)}(r,t)&&function(n,s){for(let o of Vn(n))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(r,t)&&function(n,s){for(let o of n.filters)if(!o.matches(s))return!1;return!0}(r,t)&&function(n,s){return!(n.startAt&&!function(u,l,h){let f=Fc(u,l,h);return u.inclusive?f<=0:f<0}(n.startAt,Vn(n),s)||n.endAt&&!function(u,l,h){let f=Fc(u,l,h);return u.inclusive?f>=0:f>0}(n.endAt,Vn(n),s))}(r,t)}function Fd(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function vl(r){return(t,e)=>{let n=!1;for(let s of Vn(r)){let o=Md(s,t,e);if(o!==0)return o;n=n||s.field.isKeyField()}return 0}}function Md(r,t,e){let n=r.field.isKeyField()?F.comparator(t.key,e.key):function(o,u,l){let h=u.data.field(o),f=l.data.field(o);return h!==null&&f!==null?Be(h,f):M()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return M()}}var Jt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[s,o]of n)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){ae(this.inner,(e,n)=>{for(let[s,o]of n)t(s,o)})}isEmpty(){return cl(this.inner)}size(){return this.innerSize}};var Ld=new nt(F.comparator);function Yt(){return Ld}var wl=new nt(F.comparator);function Pn(...r){let t=wl;for(let e of r)t=t.insert(e.key,e);return t}function Il(r){let t=wl;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function fe(){return kn()}function Tl(){return kn()}function kn(){return new Jt(r=>r.toString(),(r,t)=>r.isEqual(t))}var Bd=new nt(F.comparator),qd=new at(F.comparator);function q(...r){let t=qd;for(let e of r)t=t.add(e);return t}var Ud=new at(G);function Gd(){return Ud}function ua(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:On(t)?"-0":t}}function El(r){return{integerValue:""+r}}function jd(r,t){return Ed(t)?El(t):ua(r,t)}var ze=class{constructor(){this._=void 0}};function zd(r,t,e){return r instanceof $e?function(s,o){let u={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&ra(o)&&(o=vi(o)),o&&(u.fields.__previous_value__=o),{mapValue:u}}(e,t):r instanceof ye?bl(r,t):r instanceof ve?Sl(r,t):function(s,o){let u=Al(s,o),l=qc(u)+qc(s.Pe);return xs(u)&&xs(s.Pe)?El(l):ua(s.serializer,l)}(r,t)}function $d(r,t,e){return r instanceof ye?bl(r,t):r instanceof ve?Sl(r,t):e}function Al(r,t){return r instanceof Ke?function(n){return xs(n)||function(o){return!!o&&"doubleValue"in o}(n)}(t)?t:{integerValue:0}:null}var $e=class extends ze{},ye=class extends ze{constructor(t){super(),this.elements=t}};function bl(r,t){let e=Rl(t);for(let n of r.elements)e.some(s=>kt(s,n))||e.push(n);return{arrayValue:{values:e}}}var ve=class extends ze{constructor(t){super(),this.elements=t}};function Sl(r,t){let e=Rl(t);for(let n of r.elements)e=e.filter(s=>!kt(s,n));return{arrayValue:{values:e}}}var Ke=class extends ze{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function qc(r){return X(r.integerValue||r.doubleValue)}function Rl(r){return ia(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function Kd(r,t){return r.field.isEqual(t.field)&&function(n,s){return n instanceof ye&&s instanceof ye||n instanceof ve&&s instanceof ve?Le(n.elements,s.elements,kt):n instanceof Ke&&s instanceof Ke?kt(n.Pe,s.Pe):n instanceof $e&&s instanceof $e}(r.transform,t.transform)}var js=class{constructor(t,e){this.version=t,this.transformResults=e}},$t=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Lr(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var Qe=class{};function Cl(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Ln(r.key,$t.none()):new we(r.key,r.data,$t.none());{let e=r.data,n=wt.empty(),s=new at(It.comparator);for(let o of t.fields)if(!s.has(o)){let u=e.field(o);u===null&&o.length>1&&(o=o.popLast(),u=e.field(o)),u===null?n.delete(o):n.set(o,u),s=s.add(o)}return new Ot(r.key,n,new At(s.toArray()),$t.none())}}function Qd(r,t,e){r instanceof we?function(s,o,u){let l=s.value.clone(),h=Gc(s.fieldTransforms,o,u.transformResults);l.setAll(h),o.convertToFoundDocument(u.version,l).setHasCommittedMutations()}(r,t,e):r instanceof Ot?function(s,o,u){if(!Lr(s.precondition,o))return void o.convertToUnknownDocument(u.version);let l=Gc(s.fieldTransforms,o,u.transformResults),h=o.data;h.setAll(Dl(s)),h.setAll(l),o.convertToFoundDocument(u.version,h).setHasCommittedMutations()}(r,t,e):function(s,o,u){o.convertToNoDocument(u.version).setHasCommittedMutations()}(0,t,e)}function Nn(r,t,e,n){return r instanceof we?function(o,u,l,h){if(!Lr(o.precondition,u))return l;let f=o.value.clone(),p=jc(o.fieldTransforms,h,u);return f.setAll(p),u.convertToFoundDocument(u.version,f).setHasLocalMutations(),null}(r,t,e,n):r instanceof Ot?function(o,u,l,h){if(!Lr(o.precondition,u))return l;let f=jc(o.fieldTransforms,h,u),p=u.data;return p.setAll(Dl(o)),p.setAll(f),u.convertToFoundDocument(u.version,p).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(T=>T.field))}(r,t,e,n):function(o,u,l){return Lr(o.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):l}(r,t,e)}function Wd(r,t){let e=null;for(let n of r.fieldTransforms){let s=t.data.field(n.field),o=Al(n.transform,s||null);o!=null&&(e===null&&(e=wt.empty()),e.set(n.field,o))}return e||null}function Uc(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Le(n,s,(o,u)=>Kd(o,u))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var we=class extends Qe{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Ot=class extends Qe{constructor(t,e,n,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Dl(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function Gc(r,t,e){let n=new Map;W(r.length===e.length);for(let s=0;s<e.length;s++){let o=r[s],u=o.transform,l=t.data.field(o.field);n.set(o.field,$d(u,l,e[s]))}return n}function jc(r,t,e){let n=new Map;for(let s of r){let o=s.transform,u=e.data.field(s.field);n.set(s.field,zd(o,u,t))}return n}var Ln=class extends Qe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},zs=class extends Qe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var $s=class{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let o=this.mutations[s];o.key.isEqual(t.key)&&Qd(o,t,n[s])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Nn(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Nn(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=Tl();return this.mutations.forEach(s=>{let o=t.get(s.key),u=o.overlayedDocument,l=this.applyToLocalView(u,o.mutatedFields);l=e.has(s.key)?null:l;let h=Cl(u,l);h!==null&&n.set(s.key,h),u.isValidDocument()||u.convertToNoDocument(B.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),q())}isEqual(t){return this.batchId===t.batchId&&Le(this.mutations,t.mutations,(e,n)=>Uc(e,n))&&Le(this.baseMutations,t.baseMutations,(e,n)=>Uc(e,n))}},Ks=class r{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){W(t.mutations.length===n.length);let s=function(){return Bd}(),o=t.mutations;for(let u=0;u<o.length;u++)s=s.insert(o[u].key,n[u].version);return new r(t,e,n,s)}};var Qs=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ws=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var rt,z;function Hd(r){switch(r){default:return M();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0}}function Pl(r){if(r===void 0)return Qt("GRPC error has no .code"),R.UNKNOWN;switch(r){case rt.OK:return R.OK;case rt.CANCELLED:return R.CANCELLED;case rt.UNKNOWN:return R.UNKNOWN;case rt.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case rt.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case rt.INTERNAL:return R.INTERNAL;case rt.UNAVAILABLE:return R.UNAVAILABLE;case rt.UNAUTHENTICATED:return R.UNAUTHENTICATED;case rt.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case rt.NOT_FOUND:return R.NOT_FOUND;case rt.ALREADY_EXISTS:return R.ALREADY_EXISTS;case rt.PERMISSION_DENIED:return R.PERMISSION_DENIED;case rt.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case rt.ABORTED:return R.ABORTED;case rt.OUT_OF_RANGE:return R.OUT_OF_RANGE;case rt.UNIMPLEMENTED:return R.UNIMPLEMENTED;case rt.DATA_LOSS:return R.DATA_LOSS;default:return M()}}(z=rt||(rt={}))[z.OK=0]="OK",z[z.CANCELLED=1]="CANCELLED",z[z.UNKNOWN=2]="UNKNOWN",z[z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",z[z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",z[z.NOT_FOUND=5]="NOT_FOUND",z[z.ALREADY_EXISTS=6]="ALREADY_EXISTS",z[z.PERMISSION_DENIED=7]="PERMISSION_DENIED",z[z.UNAUTHENTICATED=16]="UNAUTHENTICATED",z[z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",z[z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",z[z.ABORTED=10]="ABORTED",z[z.OUT_OF_RANGE=11]="OUT_OF_RANGE",z[z.UNIMPLEMENTED=12]="UNIMPLEMENTED",z[z.INTERNAL=13]="INTERNAL",z[z.UNAVAILABLE=14]="UNAVAILABLE",z[z.DATA_LOSS=15]="DATA_LOSS";var zc=null;function Jd(){return new TextEncoder}var Yd=new Gt([4294967295,4294967295],0);function $c(r){let t=Jd().encode(r),e=new ls;return e.update(t),new Uint8Array(e.digest())}function Kc(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new Gt([e,n],0),new Gt([s,o],0)]}var Hs=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new me(`Invalid padding: ${e}`);if(n<0)throw new me(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new me(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new me(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ie=Gt.fromNumber(this.Te)}de(t,e,n){let s=t.add(e.multiply(Gt.fromNumber(n)));return s.compare(Yd)===1&&(s=new Gt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ie).toNumber()}Ee(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=$c(t),[n,s]=Kc(e);for(let o=0;o<this.hashCount;o++){let u=this.de(n,s,o);if(!this.Ee(u))return!1}return!0}static create(t,e,n){let s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),u=new r(o,s,e);return n.forEach(l=>u.insert(l)),u}insert(t){if(this.Te===0)return;let e=$c(t),[n,s]=Kc(e);for(let o=0;o<this.hashCount;o++){let u=this.de(n,s,o);this.Ae(u)}}Ae(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},me=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Kr=class r{constructor(t,e,n,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let s=new Map;return s.set(t,Bn.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(B.min(),s,new nt(G),Yt(),q())}},Bn=class r{constructor(t,e,n,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,q(),q(),q())}};var Oe=class{constructor(t,e,n,s){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=s}},Qr=class{constructor(t,e){this.targetId=t,this.me=e}},Wr=class{constructor(t,e,n=gt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}},Hr=class{constructor(){this.fe=0,this.ge=Qc(),this.pe=gt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=q(),e=q(),n=q();return this.ge.forEach((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:M()}}),new Bn(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=Qc()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,W(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Js=class{constructor(t){this.Be=t,this.Le=new Map,this.ke=Yt(),this.qe=Nr(),this.Qe=Nr(),this.Ke=new nt(G)}$e(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.Ue(e,t.Ve):this.We(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.We(e,t.key,t.Ve)}Ge(t){this.forEachTarget(t,e=>{let n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.je(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.De(t.resumeToken));break;default:M()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Le.forEach((n,s)=>{this.je(s)&&e(s)})}Je(t){let e=t.targetId,n=t.me.count,s=this.Ye(e);if(s){let o=s.target;if(Us(o))if(n===0){let u=new F(o.path);this.We(e,u,St.newNoDocument(u,B.min()))}else W(n===1);else{let u=this.Ze(e);if(u!==n){let l=this.Xe(t),h=l?this.et(l,t,u):1;if(h!==0){this.He(e);let f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,f)}zc?.tt(function(p,T,b,C,x){var N,P,U,$,Q,Z;let Tt={localCacheCount:p,existenceFilterCount:T.count,databaseId:b.database,projectId:b.projectId},J=T.unchangedNames;return J&&(Tt.bloomFilter={applied:x===0,hashCount:(N=J?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:($=(U=(P=J?.bits)===null||P===void 0?void 0:P.bitmap)===null||U===void 0?void 0:U.length)!==null&&$!==void 0?$:0,padding:(Z=(Q=J?.bits)===null||Q===void 0?void 0:Q.padding)!==null&&Z!==void 0?Z:0,mightContain:w=>{var m;return(m=C?.mightContain(w))!==null&&m!==void 0&&m}}),Tt}(u,t.me,this.Be.nt(),l,h))}}}}Xe(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:o=0}=e,u,l;try{u=Ht(n).toUint8Array()}catch(h){if(h instanceof jr)return Me("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Hs(u,s,o)}catch(h){return Me(h instanceof me?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.Te===0?null:l}et(t,e,n){return e.me.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){let n=this.Be.getRemoteKeysForTarget(e),s=0;return n.forEach(o=>{let u=this.Be.nt(),l=`projects/${u.projectId}/databases/${u.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.We(e,o,null),s++)}),s}it(t){let e=new Map;this.Le.forEach((o,u)=>{let l=this.Ye(u);if(l){if(o.current&&Us(l.target)){let h=new F(l.target.path);this.st(h).has(u)||this.ot(u,h)||this.We(u,h,St.newNoDocument(h,t))}o.be&&(e.set(u,o.ve()),o.Ce())}});let n=q();this.Qe.forEach((o,u)=>{let l=!0;u.forEachWhile(h=>{let f=this.Ye(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(o))}),this.ke.forEach((o,u)=>u.setReadTime(t));let s=new Kr(t,e,this.Ke,this.ke,n);return this.ke=Yt(),this.qe=Nr(),this.Qe=Nr(),this.Ke=new nt(G),s}Ue(t,e){if(!this.je(t))return;let n=this.ot(t,e.key)?2:0;this.ze(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t)),this.Qe=this.Qe.insert(e.key,this._t(e.key).add(t))}We(t,e,n){if(!this.je(t))return;let s=this.ze(t);this.ot(t,e)?s.Fe(e,1):s.Me(e),this.Qe=this.Qe.insert(e,this._t(e).delete(t)),this.Qe=this.Qe.insert(e,this._t(e).add(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Le.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.ze(t).xe()}ze(t){let e=this.Le.get(t);return e||(e=new Hr,this.Le.set(t,e)),e}_t(t){let e=this.Qe.get(t);return e||(e=new at(G),this.Qe=this.Qe.insert(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new at(G),this.qe=this.qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||k("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.Le.get(t);return e&&e.Se?null:this.Be.ut(t)}He(t){this.Le.set(t,new Hr),this.Be.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}ot(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}};function Nr(){return new nt(F.comparator)}function Qc(){return new nt(F.comparator)}var Xd={asc:"ASCENDING",desc:"DESCENDING"},Zd={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tf={and:"AND",or:"OR"},Ys=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Xs(r,t){return r.useProto3Json||yi(t)?t:{value:t}}function Jr(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function xl(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function ef(r,t){return Jr(r,t.toTimestamp())}function Vt(r){return W(!!r),B.fromTimestamp(function(e){let n=Wt(e);return new ct(n.seconds,n.nanos)}(r))}function ca(r,t){return Zs(r,t).canonicalString()}function Zs(r,t){let e=function(s){return new et(["projects",s.projectId,"databases",s.database])}(r).child("documents");return t===void 0?e:e.child(t)}function Vl(r){let t=et.fromString(r);return W(Ml(t)),t}function to(r,t){return ca(r.databaseId,t.path)}function ps(r,t){let e=Vl(t);if(e.get(1)!==r.databaseId.projectId)throw new O(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new O(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new F(Nl(e))}function kl(r,t){return ca(r.databaseId,t)}function nf(r){let t=Vl(r);return t.length===4?et.emptyPath():Nl(t)}function eo(r){return new et(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Nl(r){return W(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Wc(r,t,e){return{name:to(r,t),fields:e.value.mapValue.fields}}function rf(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:M()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=function(f,p){return f.useProto3Json?(W(p===void 0||typeof p=="string"),gt.fromBase64String(p||"")):(W(p===void 0||p instanceof Buffer||p instanceof Uint8Array),gt.fromUint8Array(p||new Uint8Array))}(r,t.targetChange.resumeToken),u=t.targetChange.cause,l=u&&function(f){let p=f.code===void 0?R.UNKNOWN:Pl(f.code);return new O(p,f.message||"")}(u);e=new Wr(n,s,o,l||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let s=ps(r,n.document.name),o=Vt(n.document.updateTime),u=n.document.createTime?Vt(n.document.createTime):B.min(),l=new wt({mapValue:{fields:n.document.fields}}),h=St.newFoundDocument(s,o,u,l),f=n.targetIds||[],p=n.removedTargetIds||[];e=new Oe(f,p,h.key,h)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let s=ps(r,n.document),o=n.readTime?Vt(n.readTime):B.min(),u=St.newNoDocument(s,o),l=n.removedTargetIds||[];e=new Oe([],l,u.key,u)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let s=ps(r,n.document),o=n.removedTargetIds||[];e=new Oe([],o,s,null)}else{if(!("filter"in t))return M();{t.filter;let n=t.filter;n.targetId;let{count:s=0,unchangedNames:o}=n,u=new Ws(s,o),l=n.targetId;e=new Qr(l,u)}}return e}function sf(r,t){let e;if(t instanceof we)e={update:Wc(r,t.key,t.value)};else if(t instanceof Ln)e={delete:to(r,t.key)};else if(t instanceof Ot)e={update:Wc(r,t.key,t.data),updateMask:mf(t.fieldMask)};else{if(!(t instanceof zs))return M();e={verify:to(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(o,u){let l=u.transform;if(l instanceof $e)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ye)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ve)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ke)return{fieldPath:u.field.canonicalString(),increment:l.Pe};throw M()}(0,n))),t.precondition.isNone||(e.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:ef(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:M()}(r,t.precondition)),e}function of(r,t){return r&&r.length>0?(W(t!==void 0),r.map(e=>function(s,o){let u=s.updateTime?Vt(s.updateTime):Vt(o);return u.isEqual(B.min())&&(u=Vt(o)),new js(u,s.transformResults||[])}(e,t))):[]}function af(r,t){return{documents:[kl(r,t.path)]}}function uf(r,t){let e={structuredQuery:{}},n=t.path,s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=kl(r,s);let o=function(f){if(f.length!==0)return Fl(Nt.create(f,"and"))}(t.filters);o&&(e.structuredQuery.where=o);let u=function(f){if(f.length!==0)return f.map(p=>function(b){return{field:Ve(b.field),direction:hf(b.dir)}}(p))}(t.orderBy);u&&(e.structuredQuery.orderBy=u);let l=Xs(r,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(t.endAt)),{ct:e,parent:s}}function cf(r){let t=nf(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,s=null;if(n>0){W(n===1);let p=e.from[0];p.allDescendants?s=p.collectionId:t=t.child(p.collectionId)}let o=[];e.where&&(o=function(T){let b=Ol(T);return b instanceof Nt&&ml(b)?b.getFilters():[b]}(e.where));let u=[];e.orderBy&&(u=function(T){return T.map(b=>function(x){return new Ge(ke(x.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(b))}(e.orderBy));let l=null;e.limit&&(l=function(T){let b;return b=typeof T=="object"?T.value:T,yi(b)?null:b}(e.limit));let h=null;e.startAt&&(h=function(T){let b=!!T.before,C=T.values||[];return new Ue(C,b)}(e.startAt));let f=null;return e.endAt&&(f=function(T){let b=!T.before,C=T.values||[];return new Ue(C,b)}(e.endAt)),kd(t,s,u,o,l,"F",h,f)}function lf(r,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Ol(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=ke(e.unaryFilter.field);return st.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=ke(e.unaryFilter.field);return st.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=ke(e.unaryFilter.field);return st.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let u=ke(e.unaryFilter.field);return st.create(u,"!=",{nullValue:"NULL_VALUE"});default:return M()}}(r):r.fieldFilter!==void 0?function(e){return st.create(ke(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return M()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return Nt.create(e.compositeFilter.filters.map(n=>Ol(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return M()}}(e.compositeFilter.op))}(r):M()}function hf(r){return Xd[r]}function df(r){return Zd[r]}function ff(r){return tf[r]}function Ve(r){return{fieldPath:r.canonicalString()}}function ke(r){return It.fromServerFormat(r.fieldPath)}function Fl(r){return r instanceof st?function(e){if(e.op==="=="){if(Oc(e.value))return{unaryFilter:{field:Ve(e.field),op:"IS_NAN"}};if(Nc(e.value))return{unaryFilter:{field:Ve(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Oc(e.value))return{unaryFilter:{field:Ve(e.field),op:"IS_NOT_NAN"}};if(Nc(e.value))return{unaryFilter:{field:Ve(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ve(e.field),op:df(e.op),value:e.value}}}(r):r instanceof Nt?function(e){let n=e.getFilters().map(s=>Fl(s));return n.length===1?n[0]:{compositeFilter:{op:ff(e.op),filters:n}}}(r):M()}function mf(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Ml(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var qn=class r{constructor(t,e,n,s,o=B.min(),u=B.min(),l=gt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var no=class{constructor(t){this.ht=t}};function gf(r){let t=cf({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Gs(t,t.limit,"L"):t}var Yr=class{constructor(){}dt(t,e){this.Et(t,e),e.At()}Et(t,e){if("nullValue"in t)this.Rt(e,5);else if("booleanValue"in t)this.Rt(e,10),e.Vt(t.booleanValue?1:0);else if("integerValue"in t)this.Rt(e,15),e.Vt(X(t.integerValue));else if("doubleValue"in t){let n=X(t.doubleValue);isNaN(n)?this.Rt(e,13):(this.Rt(e,15),On(n)?e.Vt(0):e.Vt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Rt(e,20),typeof n=="string"&&(n=Wt(n)),e.ft(`${n.seconds||""}`),e.Vt(n.nanos||0)}else if("stringValue"in t)this.gt(t.stringValue,e),this.yt(e);else if("bytesValue"in t)this.Rt(e,30),e.wt(Ht(t.bytesValue)),this.yt(e);else if("referenceValue"in t)this.St(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Rt(e,45),e.Vt(n.latitude||0),e.Vt(n.longitude||0)}else"mapValue"in t?hl(t)?this.Rt(e,Number.MAX_SAFE_INTEGER):ll(t)?this.bt(t.mapValue,e):(this.Dt(t.mapValue,e),this.yt(e)):"arrayValue"in t?(this.vt(t.arrayValue,e),this.yt(e)):M()}gt(t,e){this.Rt(e,25),this.Ct(t,e)}Ct(t,e){e.ft(t)}Dt(t,e){let n=t.fields||{};this.Rt(e,55);for(let s of Object.keys(n))this.gt(s,e),this.Et(n[s],e)}bt(t,e){var n,s;let o=t.fields||{};this.Rt(e,53);let u="value",l=((s=(n=o[u].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.length)||0;this.Rt(e,15),e.Vt(X(l)),this.gt(u,e),this.Et(o[u],e)}vt(t,e){let n=t.values||[];this.Rt(e,50);for(let s of n)this.Et(s,e)}St(t,e){this.Rt(e,37),F.fromName(t).path.forEach(n=>{this.Rt(e,60),this.Ct(n,e)})}Rt(t,e){t.Vt(e)}yt(t){t.Vt(2)}};Yr.Ft=new Yr;var ro=class{constructor(){this.ln=new io}addToCollectionParentIndex(t,e){return this.ln.add(e),S.resolve()}getCollectionParents(t,e){return S.resolve(this.ln.getEntries(e))}addFieldIndex(t,e){return S.resolve()}deleteFieldIndex(t,e){return S.resolve()}deleteAllFieldIndexes(t){return S.resolve()}createTargetIndexes(t,e){return S.resolve()}getDocumentsMatchingTarget(t,e){return S.resolve(null)}getIndexType(t,e){return S.resolve(0)}getFieldIndexes(t,e){return S.resolve([])}getNextCollectionGroupToUpdate(t){return S.resolve(null)}getMinOffset(t,e){return S.resolve(_e.min())}getMinOffsetFromCollectionGroup(t,e){return S.resolve(_e.min())}updateCollectionGroup(t,e,n){return S.resolve()}updateIndexEntries(t,e){return S.resolve()}},io=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new at(et.comparator),o=!s.has(n);return this.index[e]=s.add(n),o}has(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new at(et.comparator)).toArray()}};var Rg=new Uint8Array(0);var Hc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Et=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};Et.DEFAULT_COLLECTION_PERCENTILE=10,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Et.DEFAULT=new Et(41943040,Et.DEFAULT_COLLECTION_PERCENTILE,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Et.DISABLED=new Et(-1,0,0);var Un=class r{constructor(t){this.kn=t}next(){return this.kn+=2,this.kn}static qn(){return new r(0)}static Qn(){return new r(-1)}};function Jc([r,t],[e,n]){let s=G(r,e);return s===0?G(t,n):s}var so=class{constructor(t){this.Gn=t,this.buffer=new at(Jc),this.zn=0}jn(){return++this.zn}Hn(t){let e=[t,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Jc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},oo=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(t){k("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ze(e)?k("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Xe(e)}yield this.Yn(3e5)}))}},ao=class{constructor(t,e){this.Zn=t,this.params=e}calculateTargetCount(t,e){return this.Zn.Xn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return S.resolve(na.oe);let n=new so(e);return this.Zn.forEachTarget(t,s=>n.Hn(s.sequenceNumber)).next(()=>this.Zn.er(t,s=>n.Hn(s))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Zn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Hc)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Hc):this.tr(t,e))}getCacheSize(t){return this.Zn.getCacheSize(t)}tr(t,e){let n,s,o,u,l,h,f,p=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(T=>(T>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${T}`),s=this.params.maximumSequenceNumbersToCollect):s=T,u=Date.now(),this.nthSequenceNumber(t,s))).next(T=>(n=T,l=Date.now(),this.removeTargets(t,n,e))).next(T=>(o=T,h=Date.now(),this.removeOrphanedDocuments(t,n))).next(T=>(f=Date.now(),Pe()<=Dt.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-p}ms
	Determined least recently used ${s} in `+(l-u)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${T} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:T})))}};function pf(r,t){return new ao(r,t)}var uo=class{constructor(){this.changes=new Jt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,St.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?S.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var co=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var lo=class{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(n!==null&&Nn(n.mutation,s,At.empty(),ct.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,q()).next(()=>n))}getLocalViewOfDocuments(t,e,n=q()){let s=fe();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(o=>{let u=Pn();return o.forEach((l,h)=>{u=u.insert(l,h.overlayedDocument)}),u}))}getOverlayedDocuments(t,e){let n=fe();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,q()))}populateOverlays(t,e,n){let s=[];return n.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((u,l)=>{e.set(u,l)})})}computeViews(t,e,n,s){let o=Yt(),u=kn(),l=function(){return kn()}();return e.forEach((h,f)=>{let p=n.get(f.key);s.has(f.key)&&(p===void 0||p.mutation instanceof Ot)?o=o.insert(f.key,f):p!==void 0?(u.set(f.key,p.mutation.getFieldMask()),Nn(p.mutation,f,p.mutation.getFieldMask(),ct.now())):u.set(f.key,At.empty())}),this.recalculateAndSaveOverlays(t,o).next(h=>(h.forEach((f,p)=>u.set(f,p)),e.forEach((f,p)=>{var T;return l.set(f,new co(p,(T=u.get(f))!==null&&T!==void 0?T:null))}),l))}recalculateAndSaveOverlays(t,e){let n=kn(),s=new nt((u,l)=>u-l),o=q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(u=>{for(let l of u)l.keys().forEach(h=>{let f=e.get(h);if(f===null)return;let p=n.get(h)||At.empty();p=l.applyToLocalView(f,p),n.set(h,p);let T=(s.get(l.batchId)||q()).add(h);s=s.insert(l.batchId,T)})}).next(()=>{let u=[],l=s.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),f=h.key,p=h.value,T=Tl();p.forEach(b=>{if(!o.has(b)){let C=Cl(e.get(b),n.get(b));C!==null&&T.set(b,C),o=o.add(b)}}),u.push(this.documentOverlayCache.saveOverlays(t,f,T))}return S.waitFor(u)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,s){return function(u){return F.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Nd(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(o=>{let u=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-o.size):S.resolve(fe()),l=-1,h=o;return u.next(f=>S.forEach(f,(p,T)=>(l<T.largestBatchId&&(l=T.largestBatchId),o.get(p)?S.resolve():this.remoteDocumentCache.getEntry(t,p).next(b=>{h=h.insert(p,b)}))).next(()=>this.populateOverlays(t,f,o)).next(()=>this.computeViews(t,h,f,q())).next(p=>({batchId:l,changes:Il(p)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new F(e)).next(n=>{let s=Pn();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){let o=e.collectionGroup,u=Pn();return this.indexManager.getCollectionParents(t,o).next(l=>S.forEach(l,h=>{let f=function(T,b){return new je(b,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt)}(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,n,s).next(p=>{p.forEach((T,b)=>{u=u.insert(T,b)})})}).next(()=>u))}getDocumentsMatchingCollectionQuery(t,e,n,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(u=>(o=u,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,o,s))).next(u=>{o.forEach((h,f)=>{let p=f.getKey();u.get(p)===null&&(u=u.insert(p,St.newInvalidDocument(p)))});let l=Pn();return u.forEach((h,f)=>{let p=o.get(h);p!==void 0&&Nn(p.mutation,f,At.empty(),ct.now()),Ii(e,f)&&(l=l.insert(h,f))}),l})}};var ho=class{constructor(t){this.serializer=t,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(t,e){return S.resolve(this.Tr.get(e))}saveBundleMetadata(t,e){return this.Tr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:Vt(s.createTime)}}(e)),S.resolve()}getNamedQuery(t,e){return S.resolve(this.Ir.get(e))}saveNamedQuery(t,e){return this.Ir.set(e.name,function(s){return{name:s.name,query:gf(s.bundledQuery),readTime:Vt(s.readTime)}}(e)),S.resolve()}};var fo=class{constructor(){this.overlays=new nt(F.comparator),this.dr=new Map}getOverlay(t,e){return S.resolve(this.overlays.get(e))}getOverlays(t,e){let n=fe();return S.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&n.set(s,o)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((s,o)=>{this.Tt(t,e,o)}),S.resolve()}removeOverlaysForBatchId(t,e,n){let s=this.dr.get(n);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.dr.delete(n)),S.resolve()}getOverlaysForCollection(t,e,n){let s=fe(),o=e.length+1,u=new F(e.child("")),l=this.overlays.getIteratorFrom(u);for(;l.hasNext();){let h=l.getNext().value,f=h.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>n&&s.set(h.getKey(),h)}return S.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let o=new nt((f,p)=>f-p),u=this.overlays.getIterator();for(;u.hasNext();){let f=u.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>n){let p=o.get(f.largestBatchId);p===null&&(p=fe(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}let l=fe(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,p)=>l.set(f,p)),!(l.size()>=s)););return S.resolve(l)}Tt(t,e,n){let s=this.overlays.get(n.key);if(s!==null){let u=this.dr.get(s.largestBatchId).delete(n.key);this.dr.set(s.largestBatchId,u)}this.overlays=this.overlays.insert(n.key,new Qs(e,n));let o=this.dr.get(e);o===void 0&&(o=q(),this.dr.set(e,o)),this.dr.set(e,o.add(n.key))}};var mo=class{constructor(){this.sessionToken=gt.EMPTY_BYTE_STRING}getSessionToken(t){return S.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,S.resolve()}};var Gn=class{constructor(){this.Er=new at(it.Ar),this.Rr=new at(it.Vr)}isEmpty(){return this.Er.isEmpty()}addReference(t,e){let n=new it(t,e);this.Er=this.Er.add(n),this.Rr=this.Rr.add(n)}mr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.gr(new it(t,e))}pr(t,e){t.forEach(n=>this.removeReference(n,e))}yr(t){let e=new F(new et([])),n=new it(e,t),s=new it(e,t+1),o=[];return this.Rr.forEachInRange([n,s],u=>{this.gr(u),o.push(u.key)}),o}wr(){this.Er.forEach(t=>this.gr(t))}gr(t){this.Er=this.Er.delete(t),this.Rr=this.Rr.delete(t)}Sr(t){let e=new F(new et([])),n=new it(e,t),s=new it(e,t+1),o=q();return this.Rr.forEachInRange([n,s],u=>{o=o.add(u.key)}),o}containsKey(t){let e=new it(t,0),n=this.Er.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},it=class{constructor(t,e){this.key=t,this.br=e}static Ar(t,e){return F.comparator(t.key,e.key)||G(t.br,e.br)}static Vr(t,e){return G(t.br,e.br)||F.comparator(t.key,e.key)}};var go=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Dr=1,this.vr=new at(it.Ar)}checkEmpty(t){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){let o=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let u=new $s(o,e,n,s);this.mutationQueue.push(u);for(let l of s)this.vr=this.vr.add(new it(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return S.resolve(u)}lookupMutationBatch(t,e){return S.resolve(this.Cr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=this.Fr(n),o=s<0?0:s;return S.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(t){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new it(e,0),s=new it(e,Number.POSITIVE_INFINITY),o=[];return this.vr.forEachInRange([n,s],u=>{let l=this.Cr(u.br);o.push(l)}),S.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new at(G);return e.forEach(s=>{let o=new it(s,0),u=new it(s,Number.POSITIVE_INFINITY);this.vr.forEachInRange([o,u],l=>{n=n.add(l.br)})}),S.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,o=n;F.isDocumentKey(o)||(o=o.child(""));let u=new it(new F(o),0),l=new at(G);return this.vr.forEachWhile(h=>{let f=h.key.path;return!!n.isPrefixOf(f)&&(f.length===s&&(l=l.add(h.br)),!0)},u),S.resolve(this.Mr(l))}Mr(t){let e=[];return t.forEach(n=>{let s=this.Cr(n);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){W(this.Or(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.vr;return S.forEach(e.mutations,s=>{let o=new it(s.key,e.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.vr=n})}Bn(t){}containsKey(t,e){let n=new it(e,0),s=this.vr.firstAfterOrEqual(n);return S.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,S.resolve()}Or(t,e){return this.Fr(t)}Fr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Cr(t){let e=this.Fr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var po=class{constructor(t){this.Nr=t,this.docs=function(){return new nt(F.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,s=this.docs.get(n),o=s?s.size:0,u=this.Nr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return S.resolve(n?n.document.mutableCopy():St.newInvalidDocument(e))}getEntries(t,e){let n=Yt();return e.forEach(s=>{let o=this.docs.get(s);n=n.insert(s,o?o.document.mutableCopy():St.newInvalidDocument(s))}),S.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let o=Yt(),u=e.path,l=new F(u.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:f,value:{document:p}}=h.getNext();if(!u.isPrefixOf(f.path))break;f.path.length>u.length+1||wd(vd(p),n)<=0||(s.has(p.key)||Ii(e,p))&&(o=o.insert(p.key,p.mutableCopy()))}return S.resolve(o)}getAllFromCollectionGroup(t,e,n,s){M()}Br(t,e){return S.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new _o(this)}getSize(t){return S.resolve(this.size)}},_o=class extends uo{constructor(t){super(),this.hr=t}applyChanges(t){let e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.hr.addEntry(t,s)):this.hr.removeEntry(n)}),S.waitFor(e)}getFromCache(t,e){return this.hr.getEntry(t,e)}getAllFromCache(t,e){return this.hr.getEntries(t,e)}};var yo=class{constructor(t){this.persistence=t,this.Lr=new Jt(e=>sa(e),oa),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.kr=0,this.qr=new Gn,this.targetCount=0,this.Qr=Un.qn()}forEachTarget(t,e){return this.Lr.forEach((n,s)=>e(s)),S.resolve()}getLastRemoteSnapshotVersion(t){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return S.resolve(this.kr)}allocateTargetId(t){return this.highestTargetId=this.Qr.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.kr&&(this.kr=e),S.resolve()}Un(t){this.Lr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Qr=new Un(e),this.highestTargetId=e),t.sequenceNumber>this.kr&&(this.kr=t.sequenceNumber)}addTargetData(t,e){return this.Un(e),this.targetCount+=1,S.resolve()}updateTargetData(t,e){return this.Un(e),S.resolve()}removeTargetData(t,e){return this.Lr.delete(e.target),this.qr.yr(e.targetId),this.targetCount-=1,S.resolve()}removeTargets(t,e,n){let s=0,o=[];return this.Lr.forEach((u,l)=>{l.sequenceNumber<=e&&n.get(l.targetId)===null&&(this.Lr.delete(u),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),S.waitFor(o).next(()=>s)}getTargetCount(t){return S.resolve(this.targetCount)}getTargetData(t,e){let n=this.Lr.get(e)||null;return S.resolve(n)}addMatchingKeys(t,e,n){return this.qr.mr(e,n),S.resolve()}removeMatchingKeys(t,e,n){this.qr.pr(e,n);let s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(u=>{o.push(s.markPotentiallyOrphaned(t,u))}),S.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.qr.yr(e),S.resolve()}getMatchingKeysForTargetId(t,e){let n=this.qr.Sr(e);return S.resolve(n)}containsKey(t,e){return S.resolve(this.qr.containsKey(e))}};var Xr=class{constructor(t,e){this.Kr={},this.overlays={},this.$r=new na(0),this.Ur=!1,this.Ur=!0,this.Wr=new mo,this.referenceDelegate=t(this),this.Gr=new yo(this),this.indexManager=new ro,this.remoteDocumentCache=function(s){return new po(s)}(n=>this.referenceDelegate.zr(n)),this.serializer=new no(e),this.jr=new ho(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new fo,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Kr[t.toKey()];return n||(n=new go(e,this.referenceDelegate),this.Kr[t.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(t,e,n){k("MemoryPersistence","Starting transaction:",t);let s=new vo(this.$r.next());return this.referenceDelegate.Hr(),n(s).next(o=>this.referenceDelegate.Jr(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Yr(t,e){return S.or(Object.values(this.Kr).map(n=>()=>n.containsKey(t,e)))}},vo=class extends Cs{constructor(t){super(),this.currentSequenceNumber=t}},wo=class r{constructor(t){this.persistence=t,this.Zr=new Gn,this.Xr=null}static ei(t){return new r(t)}get ti(){if(this.Xr)return this.Xr;throw M()}addReference(t,e,n){return this.Zr.addReference(n,e),this.ti.delete(n.toString()),S.resolve()}removeReference(t,e,n){return this.Zr.removeReference(n,e),this.ti.add(n.toString()),S.resolve()}markPotentiallyOrphaned(t,e){return this.ti.add(e.toString()),S.resolve()}removeTarget(t,e){this.Zr.yr(e.targetId).forEach(s=>this.ti.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.ti.add(o.toString()))}).next(()=>n.removeTargetData(t,e))}Hr(){this.Xr=new Set}Jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.ti,n=>{let s=F.fromPath(n);return this.ni(t,s).next(o=>{o||e.removeEntry(s,B.min())})}).next(()=>(this.Xr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ni(t,e).next(n=>{n?this.ti.delete(e.toString()):this.ti.add(e.toString())})}zr(t){return 0}ni(t,e){return S.or([()=>S.resolve(this.Zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Yr(t,e)])}},Zr=class r{constructor(t,e){this.persistence=t,this.ri=new Jt(n=>Ad(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=pf(this,e)}static ei(t,e){return new r(t,e)}Hr(){}Jr(t){return S.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Xn(t){let e=this.nr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}nr(t){let e=0;return this.er(t,n=>{e++}).next(()=>e)}er(t,e){return S.forEach(this.ri,(n,s)=>this.ir(t,n,s).next(o=>o?S.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.Br(t,u=>this.ir(t,u,e).next(l=>{l||(n++,o.removeEntry(u,B.min()))})).next(()=>o.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.ri.set(e,t.currentSequenceNumber),S.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),S.resolve()}removeReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),S.resolve()}updateLimboDocument(t,e){return this.ri.set(e,t.currentSequenceNumber),S.resolve()}zr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Fr(t.data.value)),e}ir(t,e,n){return S.or([()=>this.persistence.Yr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.ri.get(e);return S.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Io=class r{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Wi=n,this.Gi=s}static zi(t,e){let n=q(),s=q();for(let o of e.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new r(t,e.fromCache,n,s)}};var To=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Eo=class{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return ic()?8:Td(rc())>0?6:4}()}initialize(t,e){this.Zi=t,this.indexManager=e,this.ji=!0}getDocumentsMatchingQuery(t,e,n,s){let o={result:null};return this.Xi(t,e).next(u=>{o.result=u}).next(()=>{if(!o.result)return this.es(t,e,s,n).next(u=>{o.result=u})}).next(()=>{if(o.result)return;let u=new To;return this.ts(t,e,u).next(l=>{if(o.result=l,this.Hi)return this.ns(t,e,u,l.size)})}).next(()=>o.result)}ns(t,e,n,s){return n.documentReadCount<this.Ji?(Pe()<=Dt.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",xe(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),S.resolve()):(Pe()<=Dt.DEBUG&&k("QueryEngine","Query:",xe(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Yi*s?(Pe()<=Dt.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",xe(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,xt(e))):S.resolve())}Xi(t,e){if(Bc(e))return S.resolve(null);let n=xt(e);return this.indexManager.getIndexType(t,n).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Gs(e,null,"F"),n=xt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(o=>{let u=q(...o);return this.Zi.getDocuments(t,u).next(l=>this.indexManager.getMinOffset(t,n).next(h=>{let f=this.rs(e,l);return this.ss(e,f,u,h.readTime)?this.Xi(t,Gs(e,null,"F")):this.os(t,f,e,h)}))})))}es(t,e,n,s){return Bc(e)||s.isEqual(B.min())?S.resolve(null):this.Zi.getDocuments(t,n).next(o=>{let u=this.rs(e,o);return this.ss(e,u,n,s)?S.resolve(null):(Pe()<=Dt.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),xe(e)),this.os(t,u,e,yd(s,-1)).next(l=>l))})}rs(t,e){let n=new at(vl(t));return e.forEach((s,o)=>{Ii(t,o)&&(n=n.add(o))}),n}ss(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ts(t,e,n){return Pe()<=Dt.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",xe(e)),this.Zi.getDocumentsMatchingQuery(t,e,_e.min(),n)}os(t,e,n,s){return this.Zi.getDocumentsMatchingQuery(t,n,s).next(o=>(e.forEach(u=>{o=o.insert(u.key,u)}),o))}};var Ao=class{constructor(t,e,n,s){this.persistence=t,this._s=e,this.serializer=s,this.us=new nt(G),this.cs=new Jt(o=>sa(o),oa),this.ls=new Map,this.hs=t.getRemoteDocumentCache(),this.Gr=t.getTargetCache(),this.jr=t.getBundleCache(),this.Ps(n)}Ps(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new lo(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.us))}};function _f(r,t,e,n){return new Ao(r,t,e,n)}function Ll(r,t){return V(this,null,function*(){let e=L(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next(o=>(s=o,e.Ps(t),e.mutationQueue.getAllMutationBatches(n))).next(o=>{let u=[],l=[],h=q();for(let f of s){u.push(f.batchId);for(let p of f.mutations)h=h.add(p.key)}for(let f of o){l.push(f.batchId);for(let p of f.mutations)h=h.add(p.key)}return e.localDocuments.getDocuments(n,h).next(f=>({Ts:f,removedBatchIds:u,addedBatchIds:l}))})})})}function yf(r,t){let e=L(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=t.batch.keys(),o=e.hs.newChangeBuffer({trackRemovals:!0});return function(l,h,f,p){let T=f.batch,b=T.keys(),C=S.resolve();return b.forEach(x=>{C=C.next(()=>p.getEntry(h,x)).next(N=>{let P=f.docVersions.get(x);W(P!==null),N.version.compareTo(P)<0&&(T.applyToRemoteDocument(N,f),N.isValidDocument()&&(N.setReadTime(f.commitVersion),p.addEntry(N)))})}),C.next(()=>l.mutationQueue.removeMutationBatch(h,T))}(e,n,t,o).next(()=>o.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let h=q();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h}(t))).next(()=>e.localDocuments.getDocuments(n,s))})}function Bl(r){let t=L(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Gr.getLastRemoteSnapshotVersion(e))}function vf(r,t){let e=L(r),n=t.snapshotVersion,s=e.us;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let u=e.hs.newChangeBuffer({trackRemovals:!0});s=e.us;let l=[];t.targetChanges.forEach((p,T)=>{let b=s.get(T);if(!b)return;l.push(e.Gr.removeMatchingKeys(o,p.removedDocuments,T).next(()=>e.Gr.addMatchingKeys(o,p.addedDocuments,T)));let C=b.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(T)!==null?C=C.withResumeToken(gt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):p.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(p.resumeToken,n)),s=s.insert(T,C),function(N,P,U){return N.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(b,C,p)&&l.push(e.Gr.updateTargetData(o,C))});let h=Yt(),f=q();if(t.documentUpdates.forEach(p=>{t.resolvedLimboDocuments.has(p)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,p))}),l.push(wf(o,u,t.documentUpdates).next(p=>{h=p.Is,f=p.ds})),!n.isEqual(B.min())){let p=e.Gr.getLastRemoteSnapshotVersion(o).next(T=>e.Gr.setTargetsMetadata(o,o.currentSequenceNumber,n));l.push(p)}return S.waitFor(l).next(()=>u.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(e.us=s,o))}function wf(r,t,e){let n=q(),s=q();return e.forEach(o=>n=n.add(o)),t.getEntries(r,n).next(o=>{let u=Yt();return e.forEach((l,h)=>{let f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(B.min())?(t.removeEntry(l,h.readTime),u=u.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(h),u=u.insert(l,h)):k("LocalStore","Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{Is:u,ds:s}})}function If(r,t){let e=L(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Tf(r,t){let e=L(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return e.Gr.getTargetData(n,t).next(o=>o?(s=o,S.resolve(s)):e.Gr.allocateTargetId(n).next(u=>(s=new qn(t,u,"TargetPurposeListen",n.currentSequenceNumber),e.Gr.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=e.us.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.us=e.us.insert(n.targetId,n),e.cs.set(t,n.targetId)),n})}function bo(r,t,e){return V(this,null,function*(){let n=L(r),s=n.us.get(t),o=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",o,u=>n.persistence.referenceDelegate.removeTarget(u,s)))}catch(u){if(!Ze(u))throw u;k("LocalStore",`Failed to update sequence numbers for target ${t}: ${u}`)}n.us=n.us.remove(t),n.cs.delete(s.target)})}function Yc(r,t,e){let n=L(r),s=B.min(),o=q();return n.persistence.runTransaction("Execute query","readwrite",u=>function(h,f,p){let T=L(h),b=T.cs.get(p);return b!==void 0?S.resolve(T.us.get(b)):T.Gr.getTargetData(f,p)}(n,u,xt(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,n.Gr.getMatchingKeysForTargetId(u,l.targetId).next(h=>{o=h})}).next(()=>n._s.getDocumentsMatchingQuery(u,t,e?s:B.min(),e?o:q())).next(l=>(Ef(n,Fd(t),l),{documents:l,Es:o})))}function Ef(r,t,e){let n=r.ls.get(t)||B.min();e.forEach((s,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)}),r.ls.set(t,n)}var ti=class{constructor(){this.activeTargetIds=Gd()}ps(t){this.activeTargetIds=this.activeTargetIds.add(t)}ys(t){this.activeTargetIds=this.activeTargetIds.delete(t)}gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var So=class{constructor(){this._o=new ti,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this._o.ps(t),this.ao[t]||"not-current"}updateQueryState(t,e,n){this.ao[t]=e}removeLocalQueryTarget(t){this._o.ys(t)}isLocalQueryTarget(t){return this._o.activeTargetIds.has(t)}clearQueryState(t){delete this.ao[t]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(t){return this._o.activeTargetIds.has(t)}start(){return this._o=new ti,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Ro=class{uo(t){}shutdown(){}};var ei=class{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(t){this.To.push(t)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){k("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.To)t(0)}Po(){k("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.To)t(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Or=null;function _s(){return Or===null?Or=function(){return 268435456+Math.round(2147483648*Math.random())}():Or++,"0x"+Or.toString(16)}var Af={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Co=class{constructor(t){this.Eo=t.Eo,this.Ao=t.Ao}Ro(t){this.Vo=t}mo(t){this.fo=t}po(t){this.yo=t}onMessage(t){this.wo=t}close(){this.Ao()}send(t){this.Eo(t)}So(){this.Vo()}bo(){this.fo()}Do(t){this.yo(t)}vo(t){this.wo(t)}};var mt="WebChannelConnection",Do=class extends class{get Co(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Fo=n+"://"+e.host,this.Mo=`projects/${s}/databases/${o}`,this.xo=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${o}`}Oo(e,n,s,o,u){let l=_s(),h=this.No(e,n.toUriEncodedString());k("RestConnection",`Sending RPC '${e}' ${l}:`,h,s);let f={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Bo(f,o,u),this.Lo(e,h,f,s).then(p=>(k("RestConnection",`Received RPC '${e}' ${l}: `,p),p),p=>{throw Me("RestConnection",`RPC '${e}' ${l} failed with error: `,p,"url: ",h,"request:",s),p})}ko(e,n,s,o,u,l){return this.Oo(e,n,s,o,u)}Bo(e,n,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ye}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((o,u)=>e[u]=o),s&&s.headers.forEach((o,u)=>e[u]=o)}No(e,n){let s=Af[e];return`${this.Fo}/v1/${n}:${s}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Lo(t,e,n,s){let o=_s();return new Promise((u,l)=>{let h=new hs;h.setWithCredentials(!0),h.listenOnce(ds.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Dn.NO_ERROR:let p=h.getResponseJson();k(mt,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(p)),u(p);break;case Dn.TIMEOUT:k(mt,`RPC '${t}' ${o} timed out`),l(new O(R.DEADLINE_EXCEEDED,"Request time out"));break;case Dn.HTTP_ERROR:let T=h.getStatus();if(k(mt,`RPC '${t}' ${o} failed with status:`,T,"response text:",h.getResponseText()),T>0){let b=h.getResponseJson();Array.isArray(b)&&(b=b[0]);let C=b?.error;if(C&&C.status&&C.message){let x=function(P){let U=P.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(U)>=0?U:R.UNKNOWN}(C.status);l(new O(x,C.message))}else l(new O(R.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new O(R.UNAVAILABLE,"Connection failed."));break;default:M()}}finally{k(mt,`RPC '${t}' ${o} completed.`)}});let f=JSON.stringify(s);k(mt,`RPC '${t}' ${o} sending request:`,s),h.send(e,"POST",f,n,15)})}qo(t,e,n){let s=_s(),o=[this.Fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],u=gs(),l=ms(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Bo(h.initMessageHeaders,e,n),h.encodeInitMessageHeaders=!0;let p=o.join("");k(mt,`Creating RPC '${t}' stream ${s}: ${p}`,h);let T=u.createWebChannel(p,h),b=!1,C=!1,x=new Co({Eo:P=>{C?k(mt,`Not sending because RPC '${t}' stream ${s} is closed:`,P):(b||(k(mt,`Opening RPC '${t}' stream ${s} transport.`),T.open(),b=!0),k(mt,`RPC '${t}' stream ${s} sending:`,P),T.send(P))},Ao:()=>T.close()}),N=(P,U,$)=>{P.listen(U,Q=>{try{$(Q)}catch(Z){setTimeout(()=>{throw Z},0)}})};return N(T,De.EventType.OPEN,()=>{C||(k(mt,`RPC '${t}' stream ${s} transport opened.`),x.So())}),N(T,De.EventType.CLOSE,()=>{C||(C=!0,k(mt,`RPC '${t}' stream ${s} transport closed`),x.Do())}),N(T,De.EventType.ERROR,P=>{C||(C=!0,Me(mt,`RPC '${t}' stream ${s} transport errored:`,P),x.Do(new O(R.UNAVAILABLE,"The operation could not be completed")))}),N(T,De.EventType.MESSAGE,P=>{var U;if(!C){let $=P.data[0];W(!!$);let Q=$,Z=Q?.error||((U=Q[0])===null||U===void 0?void 0:U.error);if(Z){k(mt,`RPC '${t}' stream ${s} received error:`,Z);let Tt=Z.status,J=function(_){let y=rt[_];if(y!==void 0)return Pl(y)}(Tt),w=Z.message;J===void 0&&(J=R.INTERNAL,w="Unknown error status: "+Tt+" with message "+Z.message),C=!0,x.Do(new O(J,w)),T.close()}else k(mt,`RPC '${t}' stream ${s} received:`,$),x.vo($)}}),N(l,fs.STAT_EVENT,P=>{P.stat===Vr.PROXY?k(mt,`RPC '${t}' stream ${s} detected buffering proxy`):P.stat===Vr.NOPROXY&&k(mt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.bo()},0),x}};function ys(){return typeof document<"u"?document:null}function Ti(r){return new Ys(r,!0)}var ni=class{constructor(t,e,n=1e3,s=1.5,o=6e4){this.li=t,this.timerId=e,this.Qo=n,this.Ko=s,this.$o=o,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(t){this.cancel();let e=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),s=Math.max(0,e-n);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Uo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,s,()=>(this.Go=Date.now(),t())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}};var ri=class{constructor(t,e,n,s,o,u,l,h){this.li=t,this.Yo=n,this.Zo=s,this.connection=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new ni(t,e)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}stop(){return V(this,null,function*(){this.i_()&&(yield this.close(0))})}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(t){this.l_(),this.stream.send(t)}u_(){return V(this,null,function*(){if(this.s_())return this.close(0)})}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(t,e){return V(this,null,function*(){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,t!==4?this.r_.reset():e&&e.code===R.RESOURCE_EXHAUSTED?(Qt(e.toString()),Qt("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):e&&e.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.po(e)})}P_(){}auth(){this.state=1;let t=this.T_(this.Xo),e=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Xo===e&&this.I_(n,s)},n=>{t(()=>{let s=new O(R.UNKNOWN,"Fetching auth token failed: "+n.message);return this.d_(s)})})}I_(t,e){let n=this.T_(this.Xo);this.stream=this.E_(t,e),this.stream.Ro(()=>{n(()=>this.listener.Ro())}),this.stream.mo(()=>{n(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(s=>{n(()=>this.d_(s))}),this.stream.onMessage(s=>{n(()=>++this.n_==1?this.A_(s):this.onNext(s))})}o_(){this.state=5,this.r_.jo(()=>V(this,null,function*(){this.state=0,this.start()}))}d_(t){return k("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}T_(t){return e=>{this.li.enqueueAndForget(()=>this.Xo===t?e():(k("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Po=class extends ri{constructor(t,e,n,s,o,u){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,u),this.serializer=o}E_(t,e){return this.connection.qo("Listen",t,e)}A_(t){return this.onNext(t)}onNext(t){this.r_.reset();let e=rf(this.serializer,t),n=function(o){if(!("targetChange"in o))return B.min();let u=o.targetChange;return u.targetIds&&u.targetIds.length?B.min():u.readTime?Vt(u.readTime):B.min()}(t);return this.listener.R_(e,n)}V_(t){let e={};e.database=eo(this.serializer),e.addTarget=function(o,u){let l,h=u.target;if(l=Us(h)?{documents:af(o,h)}:{query:uf(o,h).ct},l.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){l.resumeToken=xl(o,u.resumeToken);let f=Xs(o,u.expectedCount);f!==null&&(l.expectedCount=f)}else if(u.snapshotVersion.compareTo(B.min())>0){l.readTime=Jr(o,u.snapshotVersion.toTimestamp());let f=Xs(o,u.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,t);let n=lf(this.serializer,t);n&&(e.labels=n),this.c_(e)}m_(t){let e={};e.database=eo(this.serializer),e.removeTarget=t,this.c_(e)}},xo=class extends ri{constructor(t,e,n,s,o,u){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,u),this.serializer=o}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}E_(t,e){return this.connection.qo("Write",t,e)}A_(t){return W(!!t.streamToken),this.lastStreamToken=t.streamToken,W(!t.writeResults||t.writeResults.length===0),this.listener.p_()}onNext(t){W(!!t.streamToken),this.lastStreamToken=t.streamToken,this.r_.reset();let e=of(t.writeResults,t.commitTime),n=Vt(t.commitTime);return this.listener.y_(n,e)}w_(){let t={};t.database=eo(this.serializer),this.c_(t)}g_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>sf(this.serializer,n))};this.c_(e)}};var Vo=class extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.S_=!1}b_(){if(this.S_)throw new O(R.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(t,e,n,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Oo(t,Zs(e,n),s,o,u)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(R.UNKNOWN,o.toString())})}ko(t,e,n,s,o){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,l])=>this.connection.ko(t,Zs(e,n),s,u,l,o)).catch(u=>{throw u.name==="FirebaseError"?(u.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new O(R.UNKNOWN,u.toString())})}terminate(){this.S_=!0,this.connection.terminate()}},ko=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(t){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.M_("Offline")))}set(t){this.N_(),this.D_=0,t==="Online"&&(this.C_=!1),this.M_(t)}M_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}x_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(Qt(e),this.C_=!1):k("OnlineStateTracker",e)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}};var No=class{constructor(t,e,n,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.B_=[],this.L_=new Map,this.k_=new Set,this.q_=[],this.Q_=o,this.Q_.uo(u=>{n.enqueueAndForget(()=>V(this,null,function*(){Ie(this)&&(k("RemoteStore","Restarting streams for network reachability change."),yield function(h){return V(this,null,function*(){let f=L(h);f.k_.add(4),yield Qn(f),f.K_.set("Unknown"),f.k_.delete(4),yield Ei(f)})}(this))}))}),this.K_=new ko(n,s)}};function Ei(r){return V(this,null,function*(){if(Ie(r))for(let t of r.q_)yield t(!0)})}function Qn(r){return V(this,null,function*(){for(let t of r.q_)yield t(!1)})}function ql(r,t){let e=L(r);e.L_.has(t.targetId)||(e.L_.set(t.targetId,t),fa(e)?da(e):tn(e).s_()&&ha(e,t))}function la(r,t){let e=L(r),n=tn(e);e.L_.delete(t),n.s_()&&Ul(e,t),e.L_.size===0&&(n.s_()?n.a_():Ie(e)&&e.K_.set("Unknown"))}function ha(r,t){if(r.U_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}tn(r).V_(t)}function Ul(r,t){r.U_.xe(t),tn(r).m_(t)}function da(r){r.U_=new Js({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>r.L_.get(t)||null,nt:()=>r.datastore.serializer.databaseId}),tn(r).start(),r.K_.F_()}function fa(r){return Ie(r)&&!tn(r).i_()&&r.L_.size>0}function Ie(r){return L(r).k_.size===0}function Gl(r){r.U_=void 0}function bf(r){return V(this,null,function*(){r.K_.set("Online")})}function Sf(r){return V(this,null,function*(){r.L_.forEach((t,e)=>{ha(r,t)})})}function Rf(r,t){return V(this,null,function*(){Gl(r),fa(r)?(r.K_.O_(t),da(r)):r.K_.set("Unknown")})}function Cf(r,t,e){return V(this,null,function*(){if(r.K_.set("Online"),t instanceof Wr&&t.state===2&&t.cause)try{yield function(s,o){return V(this,null,function*(){let u=o.cause;for(let l of o.targetIds)s.L_.has(l)&&(yield s.remoteSyncer.rejectListen(l,u),s.L_.delete(l),s.U_.removeTarget(l))})}(r,t)}catch(n){k("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield ii(r,n)}else if(t instanceof Oe?r.U_.$e(t):t instanceof Qr?r.U_.Je(t):r.U_.Ge(t),!e.isEqual(B.min()))try{let n=yield Bl(r.localStore);e.compareTo(n)>=0&&(yield function(o,u){let l=o.U_.it(u);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.L_.get(f);p&&o.L_.set(f,p.withResumeToken(h.resumeToken,u))}}),l.targetMismatches.forEach((h,f)=>{let p=o.L_.get(h);if(!p)return;o.L_.set(h,p.withResumeToken(gt.EMPTY_BYTE_STRING,p.snapshotVersion)),Ul(o,h);let T=new qn(p.target,h,f,p.sequenceNumber);ha(o,T)}),o.remoteSyncer.applyRemoteEvent(l)}(r,e))}catch(n){k("RemoteStore","Failed to raise snapshot:",n),yield ii(r,n)}})}function ii(r,t,e){return V(this,null,function*(){if(!Ze(t))throw t;r.k_.add(1),yield Qn(r),r.K_.set("Offline"),e||(e=()=>Bl(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(this,null,function*(){k("RemoteStore","Retrying IndexedDB access"),yield e(),r.k_.delete(1),yield Ei(r)}))})}function jl(r,t){return t().catch(e=>ii(r,e,t))}function Ai(r){return V(this,null,function*(){let t=L(r),e=se(t),n=t.B_.length>0?t.B_[t.B_.length-1].batchId:-1;for(;Df(t);)try{let s=yield If(t.localStore,n);if(s===null){t.B_.length===0&&e.a_();break}n=s.batchId,Pf(t,s)}catch(s){yield ii(t,s)}zl(t)&&$l(t)})}function Df(r){return Ie(r)&&r.B_.length<10}function Pf(r,t){r.B_.push(t);let e=se(r);e.s_()&&e.f_&&e.g_(t.mutations)}function zl(r){return Ie(r)&&!se(r).i_()&&r.B_.length>0}function $l(r){se(r).start()}function xf(r){return V(this,null,function*(){se(r).w_()})}function Vf(r){return V(this,null,function*(){let t=se(r);for(let e of r.B_)t.g_(e.mutations)})}function kf(r,t,e){return V(this,null,function*(){let n=r.B_.shift(),s=Ks.from(n,t,e);yield jl(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield Ai(r)})}function Nf(r,t){return V(this,null,function*(){t&&se(r).f_&&(yield function(n,s){return V(this,null,function*(){if(function(u){return Hd(u)&&u!==R.ABORTED}(s.code)){let o=n.B_.shift();se(n).__(),yield jl(n,()=>n.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Ai(n)}})}(r,t)),zl(r)&&$l(r)})}function Xc(r,t){return V(this,null,function*(){let e=L(r);e.asyncQueue.verifyOperationInProgress(),k("RemoteStore","RemoteStore received new credentials");let n=Ie(e);e.k_.add(3),yield Qn(e),n&&e.K_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.k_.delete(3),yield Ei(e)})}function Of(r,t){return V(this,null,function*(){let e=L(r);t?(e.k_.delete(2),yield Ei(e)):t||(e.k_.add(2),yield Qn(e),e.K_.set("Unknown"))})}function tn(r){return r.W_||(r.W_=function(e,n,s){let o=L(e);return o.b_(),new Po(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(r.datastore,r.asyncQueue,{Ro:bf.bind(null,r),mo:Sf.bind(null,r),po:Rf.bind(null,r),R_:Cf.bind(null,r)}),r.q_.push(t=>V(this,null,function*(){t?(r.W_.__(),fa(r)?da(r):r.K_.set("Unknown")):(yield r.W_.stop(),Gl(r))}))),r.W_}function se(r){return r.G_||(r.G_=function(e,n,s){let o=L(e);return o.b_(),new xo(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(r.datastore,r.asyncQueue,{Ro:()=>Promise.resolve(),mo:xf.bind(null,r),po:Nf.bind(null,r),p_:Vf.bind(null,r),y_:kf.bind(null,r)}),r.q_.push(t=>V(this,null,function*(){t?(r.G_.__(),yield Ai(r)):(yield r.G_.stop(),r.B_.length>0&&(k("RemoteStore",`Stopping write stream with ${r.B_.length} pending writes`),r.B_=[]))}))),r.G_}var Oo=class r{constructor(t,e,n,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=o,this.deferred=new zt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,o){let u=Date.now()+n,l=new r(t,e,u,s,o);return l.start(n),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(R.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ma(r,t){if(Qt("AsyncQueue",`${t}: ${r}`),Ze(r))return new O(R.UNAVAILABLE,`${t}: ${r}`);throw r}var si=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||F.comparator(e.key,n.key):(e,n)=>F.comparator(e.key,n.key),this.keyedMap=Pn(),this.sortedSet=new nt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=n.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var oi=class{constructor(){this.z_=new nt(F.comparator)}track(t){let e=t.doc.key,n=this.z_.get(e);n?t.type!==0&&n.type===3?this.z_=this.z_.insert(e,t):t.type===3&&n.type!==1?this.z_=this.z_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.z_=this.z_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.z_=this.z_.remove(e):t.type===1&&n.type===2?this.z_=this.z_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):M():this.z_=this.z_.insert(e,t)}j_(){let t=[];return this.z_.inorderTraversal((e,n)=>{t.push(n)}),t}},We=class r{constructor(t,e,n,s,o,u,l,h,f){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(t,e,n,s,o){let u=[];return e.forEach(l=>{u.push({type:0,doc:l})}),new r(t,e,si.emptySet(e),u,n,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&wi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}};var Fo=class{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(t=>t.Z_())}},Mo=class{constructor(){this.queries=Zc(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(e,n){let s=L(e),o=s.queries;s.queries=Zc(),o.forEach((u,l)=>{for(let h of l.J_)h.onError(n)})})(this,new O(R.ABORTED,"Firestore shutting down"))}};function Zc(){return new Jt(r=>yl(r),wi)}function Ff(r,t){return V(this,null,function*(){let e=L(r),n=3,s=t.query,o=e.queries.get(s);o?!o.Y_()&&t.Z_()&&(n=2):(o=new Fo,n=t.Z_()?0:1);try{switch(n){case 0:o.H_=yield e.onListen(s,!0);break;case 1:o.H_=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(u){let l=ma(u,`Initialization of query '${xe(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.J_.push(t),t.ea(e.onlineState),o.H_&&t.ta(o.H_)&&ga(e)})}function Mf(r,t){return V(this,null,function*(){let e=L(r),n=t.query,s=3,o=e.queries.get(n);if(o){let u=o.J_.indexOf(t);u>=0&&(o.J_.splice(u,1),o.J_.length===0?s=t.Z_()?0:1:!o.Y_()&&t.Z_()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function Lf(r,t){let e=L(r),n=!1;for(let s of t){let o=s.query,u=e.queries.get(o);if(u){for(let l of u.J_)l.ta(s)&&(n=!0);u.H_=s}}n&&ga(e)}function Bf(r,t,e){let n=L(r),s=n.queries.get(t);if(s)for(let o of s.J_)o.onError(e);n.queries.delete(t)}function ga(r){r.X_.forEach(t=>{t.next()})}var Lo,tl;(tl=Lo||(Lo={})).na="default",tl.Cache="cache";var Bo=class{constructor(t,e,n){this.query=t,this.ra=e,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=n||{}}ta(t){if(!this.options.includeMetadataChanges){let n=[];for(let s of t.docChanges)s.type!==3&&n.push(s);t=new We(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ia?this.oa(t)&&(this.ra.next(t),e=!0):this._a(t,this.onlineState)&&(this.aa(t),e=!0),this.sa=t,e}onError(t){this.ra.error(t)}ea(t){this.onlineState=t;let e=!1;return this.sa&&!this.ia&&this._a(this.sa,t)&&(this.aa(this.sa),e=!0),e}_a(t,e){if(!t.fromCache||!this.Z_())return!0;let n=e!=="Offline";return(!this.options.ua||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}oa(t){if(t.docChanges.length>0)return!0;let e=this.sa&&this.sa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}aa(t){t=We.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ia=!0,this.ra.next(t)}Z_(){return this.options.source!==Lo.Cache}};var ai=class{constructor(t){this.key=t}},ui=class{constructor(t){this.key=t}},qo=class{constructor(t,e){this.query=t,this.Ea=e,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=q(),this.mutatedKeys=q(),this.Va=vl(t),this.ma=new si(this.Va)}get fa(){return this.Ea}ga(t,e){let n=e?e.pa:new oi,s=e?e.ma:this.ma,o=e?e.mutatedKeys:this.mutatedKeys,u=s,l=!1,h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((p,T)=>{let b=s.get(p),C=Ii(this.query,T)?T:null,x=!!b&&this.mutatedKeys.has(b.key),N=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations),P=!1;b&&C?b.data.isEqual(C.data)?x!==N&&(n.track({type:3,doc:C}),P=!0):this.ya(b,C)||(n.track({type:2,doc:C}),P=!0,(h&&this.Va(C,h)>0||f&&this.Va(C,f)<0)&&(l=!0)):!b&&C?(n.track({type:0,doc:C}),P=!0):b&&!C&&(n.track({type:1,doc:b}),P=!0,(h||f)&&(l=!0)),P&&(C?(u=u.add(C),o=N?o.add(p):o.delete(p)):(u=u.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;u.size>this.query.limit;){let p=this.query.limitType==="F"?u.last():u.first();u=u.delete(p.key),o=o.delete(p.key),n.track({type:1,doc:p})}return{ma:u,pa:n,ss:l,mutatedKeys:o}}ya(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){let o=this.ma;this.ma=t.ma,this.mutatedKeys=t.mutatedKeys;let u=t.pa.j_();u.sort((p,T)=>function(C,x){let N=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M()}};return N(C)-N(x)}(p.type,T.type)||this.Va(p.doc,T.doc)),this.wa(n),s=s!=null&&s;let l=e&&!s?this.Sa():[],h=this.Ra.size===0&&this.current&&!s?1:0,f=h!==this.Aa;return this.Aa=h,u.length!==0||f?{snapshot:new We(this.query,t.ma,o,u,t.mutatedKeys,h===0,f,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:l}:{ba:l}}ea(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new oi,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(t){return!this.Ea.has(t)&&!!this.ma.has(t)&&!this.ma.get(t).hasLocalMutations}wa(t){t&&(t.addedDocuments.forEach(e=>this.Ea=this.Ea.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ea=this.Ea.delete(e)),this.current=t.current)}Sa(){if(!this.current)return[];let t=this.Ra;this.Ra=q(),this.ma.forEach(n=>{this.Da(n.key)&&(this.Ra=this.Ra.add(n.key))});let e=[];return t.forEach(n=>{this.Ra.has(n)||e.push(new ui(n))}),this.Ra.forEach(n=>{t.has(n)||e.push(new ai(n))}),e}va(t){this.Ea=t.Es,this.Ra=q();let e=this.ga(t.documents);return this.applyChanges(e,!0)}Ca(){return We.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}},Uo=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},Go=class{constructor(t){this.key=t,this.Fa=!1}},jo=class{constructor(t,e,n,s,o,u){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.Ma={},this.xa=new Jt(l=>yl(l),wi),this.Oa=new Map,this.Na=new Set,this.Ba=new nt(F.comparator),this.La=new Map,this.ka=new Gn,this.qa={},this.Qa=new Map,this.Ka=Un.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}};function qf(r,t,e=!0){return V(this,null,function*(){let n=Yl(r),s,o=n.xa.get(t);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.Ca()):s=yield Kl(n,t,e,!0),s})}function Uf(r,t){return V(this,null,function*(){let e=Yl(r);yield Kl(e,t,!0,!1)})}function Kl(r,t,e,n){return V(this,null,function*(){let s=yield Tf(r.localStore,xt(t)),o=s.targetId,u=r.sharedClientState.addLocalQueryTarget(o,e),l;return n&&(l=yield Gf(r,t,o,u==="current",s.resumeToken)),r.isPrimaryClient&&e&&ql(r.remoteStore,s),l})}function Gf(r,t,e,n,s){return V(this,null,function*(){r.Ua=(T,b,C)=>function(N,P,U,$){return V(this,null,function*(){let Q=P.view.ga(U);Q.ss&&(Q=yield Yc(N.localStore,P.query,!1).then(({documents:w})=>P.view.ga(w,Q)));let Z=$&&$.targetChanges.get(P.targetId),Tt=$&&$.targetMismatches.get(P.targetId)!=null,J=P.view.applyChanges(Q,N.isPrimaryClient,Z,Tt);return nl(N,P.targetId,J.ba),J.snapshot})}(r,T,b,C);let o=yield Yc(r.localStore,t,!0),u=new qo(t,o.Es),l=u.ga(o.documents),h=Bn.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),f=u.applyChanges(l,r.isPrimaryClient,h);nl(r,e,f.ba);let p=new Uo(t,e,u);return r.xa.set(t,p),r.Oa.has(e)?r.Oa.get(e).push(t):r.Oa.set(e,[t]),f.snapshot})}function jf(r,t,e){return V(this,null,function*(){let n=L(r),s=n.xa.get(t),o=n.Oa.get(s.targetId);if(o.length>1)return n.Oa.set(s.targetId,o.filter(u=>!wi(u,t))),void n.xa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield bo(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),e&&la(n.remoteStore,s.targetId),zo(n,s.targetId)}).catch(Xe))):(zo(n,s.targetId),yield bo(n.localStore,s.targetId,!0))})}function zf(r,t){return V(this,null,function*(){let e=L(r),n=e.xa.get(t),s=e.Oa.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),la(e.remoteStore,n.targetId))})}function $f(r,t,e){return V(this,null,function*(){let n=Xf(r);try{let s=yield function(u,l){let h=L(u),f=ct.now(),p=l.reduce((C,x)=>C.add(x.key),q()),T,b;return h.persistence.runTransaction("Locally write mutations","readwrite",C=>{let x=Yt(),N=q();return h.hs.getEntries(C,p).next(P=>{x=P,x.forEach((U,$)=>{$.isValidDocument()||(N=N.add(U))})}).next(()=>h.localDocuments.getOverlayedDocuments(C,x)).next(P=>{T=P;let U=[];for(let $ of l){let Q=Wd($,T.get($.key).overlayedDocument);Q!=null&&U.push(new Ot($.key,Q,dl(Q.value.mapValue),$t.exists(!0)))}return h.mutationQueue.addMutationBatch(C,f,U,l)}).next(P=>{b=P;let U=P.applyToLocalDocumentSet(T,N);return h.documentOverlayCache.saveOverlays(C,P.batchId,U)})}).then(()=>({batchId:b.batchId,changes:Il(T)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),function(u,l,h){let f=u.qa[u.currentUser.toKey()];f||(f=new nt(G)),f=f.insert(l,h),u.qa[u.currentUser.toKey()]=f}(n,s.batchId,e),yield Wn(n,s.changes),yield Ai(n.remoteStore)}catch(s){let o=ma(s,"Failed to persist write");e.reject(o)}})}function Ql(r,t){return V(this,null,function*(){let e=L(r);try{let n=yield vf(e.localStore,t);t.targetChanges.forEach((s,o)=>{let u=e.La.get(o);u&&(W(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?u.Fa=!0:s.modifiedDocuments.size>0?W(u.Fa):s.removedDocuments.size>0&&(W(u.Fa),u.Fa=!1))}),yield Wn(e,n,t)}catch(n){yield Xe(n)}})}function el(r,t,e){let n=L(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let s=[];n.xa.forEach((o,u)=>{let l=u.view.ea(t);l.snapshot&&s.push(l.snapshot)}),function(u,l){let h=L(u);h.onlineState=l;let f=!1;h.queries.forEach((p,T)=>{for(let b of T.J_)b.ea(l)&&(f=!0)}),f&&ga(h)}(n.eventManager,t),s.length&&n.Ma.R_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function Kf(r,t,e){return V(this,null,function*(){let n=L(r);n.sharedClientState.updateQueryState(t,"rejected",e);let s=n.La.get(t),o=s&&s.key;if(o){let u=new nt(F.comparator);u=u.insert(o,St.newNoDocument(o,B.min()));let l=q().add(o),h=new Kr(B.min(),new Map,new nt(G),u,l);yield Ql(n,h),n.Ba=n.Ba.remove(o),n.La.delete(t),pa(n)}else yield bo(n.localStore,t,!1).then(()=>zo(n,t,e)).catch(Xe)})}function Qf(r,t){return V(this,null,function*(){let e=L(r),n=t.batch.batchId;try{let s=yield yf(e.localStore,t);Hl(e,n,null),Wl(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield Wn(e,s)}catch(s){yield Xe(s)}})}function Wf(r,t,e){return V(this,null,function*(){let n=L(r);try{let s=yield function(u,l){let h=L(u);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let p;return h.mutationQueue.lookupMutationBatch(f,l).next(T=>(W(T!==null),p=T.keys(),h.mutationQueue.removeMutationBatch(f,T))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p)).next(()=>h.localDocuments.getDocuments(f,p))})}(n.localStore,t);Hl(n,t,e),Wl(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield Wn(n,s)}catch(s){yield Xe(s)}})}function Wl(r,t){(r.Qa.get(t)||[]).forEach(e=>{e.resolve()}),r.Qa.delete(t)}function Hl(r,t,e){let n=L(r),s=n.qa[n.currentUser.toKey()];if(s){let o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),n.qa[n.currentUser.toKey()]=s}}function zo(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Oa.get(t))r.xa.delete(n),e&&r.Ma.Wa(n,e);r.Oa.delete(t),r.isPrimaryClient&&r.ka.yr(t).forEach(n=>{r.ka.containsKey(n)||Jl(r,n)})}function Jl(r,t){r.Na.delete(t.path.canonicalString());let e=r.Ba.get(t);e!==null&&(la(r.remoteStore,e),r.Ba=r.Ba.remove(t),r.La.delete(e),pa(r))}function nl(r,t,e){for(let n of e)n instanceof ai?(r.ka.addReference(n.key,t),Hf(r,n)):n instanceof ui?(k("SyncEngine","Document no longer in limbo: "+n.key),r.ka.removeReference(n.key,t),r.ka.containsKey(n.key)||Jl(r,n.key)):M()}function Hf(r,t){let e=t.key,n=e.path.canonicalString();r.Ba.get(e)||r.Na.has(n)||(k("SyncEngine","New document in limbo: "+e),r.Na.add(n),pa(r))}function pa(r){for(;r.Na.size>0&&r.Ba.size<r.maxConcurrentLimboResolutions;){let t=r.Na.values().next().value;r.Na.delete(t);let e=new F(et.fromString(t)),n=r.Ka.next();r.La.set(n,new Go(e)),r.Ba=r.Ba.insert(e,n),ql(r.remoteStore,new qn(xt(aa(e.path)),n,"TargetPurposeLimboResolution",na.oe))}}function Wn(r,t,e){return V(this,null,function*(){let n=L(r),s=[],o=[],u=[];n.xa.isEmpty()||(n.xa.forEach((l,h)=>{u.push(n.Ua(h,t,e).then(f=>{var p;if((f||e)&&n.isPrimaryClient){let T=f?!f.fromCache:(p=e?.targetChanges.get(h.targetId))===null||p===void 0?void 0:p.current;n.sharedClientState.updateQueryState(h.targetId,T?"current":"not-current")}if(f){s.push(f);let T=Io.zi(h.targetId,f);o.push(T)}}))}),yield Promise.all(u),n.Ma.R_(s),yield function(h,f){return V(this,null,function*(){let p=L(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",T=>S.forEach(f,b=>S.forEach(b.Wi,C=>p.persistence.referenceDelegate.addReference(T,b.targetId,C)).next(()=>S.forEach(b.Gi,C=>p.persistence.referenceDelegate.removeReference(T,b.targetId,C)))))}catch(T){if(!Ze(T))throw T;k("LocalStore","Failed to update sequence numbers: "+T)}for(let T of f){let b=T.targetId;if(!T.fromCache){let C=p.us.get(b),x=C.snapshotVersion,N=C.withLastLimboFreeSnapshotVersion(x);p.us=p.us.insert(b,N)}}})}(n.localStore,o))})}function Jf(r,t){return V(this,null,function*(){let e=L(r);if(!e.currentUser.isEqual(t)){k("SyncEngine","User change. New user:",t.toKey());let n=yield Ll(e.localStore,t);e.currentUser=t,function(o,u){o.Qa.forEach(l=>{l.forEach(h=>{h.reject(new O(R.CANCELLED,u))})}),o.Qa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield Wn(e,n.Ts)}})}function Yf(r,t){let e=L(r),n=e.La.get(t);if(n&&n.Fa)return q().add(n.key);{let s=q(),o=e.Oa.get(t);if(!o)return s;for(let u of o){let l=e.xa.get(u);s=s.unionWith(l.view.fa)}return s}}function Yl(r){let t=L(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ql.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Yf.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Kf.bind(null,t),t.Ma.R_=Lf.bind(null,t.eventManager),t.Ma.Wa=Bf.bind(null,t.eventManager),t}function Xf(r){let t=L(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Qf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Wf.bind(null,t),t}var Xl=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=Ti(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),yield this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)})}Ja(e,n){return null}Ya(e,n){return null}Ha(e){return _f(this.persistence,new Eo,e.initialUser,this.serializer)}ja(e){return new Xr(wo.ei,this.serializer)}za(e){return new So}terminate(){return V(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),$o=class extends Xl{constructor(t){super(),this.cacheSizeBytes=t}Ja(t,e){W(this.persistence.referenceDelegate instanceof Zr);let n=this.persistence.referenceDelegate.garbageCollector;return new oo(n,t.asyncQueue,e)}ja(t){let e=this.cacheSizeBytes!==void 0?Et.withCacheSize(this.cacheSizeBytes):Et.DEFAULT;return new Xr(n=>Zr.ei(n,e),this.serializer)}};var Zf=(()=>{class r{initialize(e,n){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>el(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Jf.bind(null,this.syncEngine),yield Of(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Mo}()}createDatastore(e){let n=Ti(e.databaseInfo.databaseId),s=function(u){return new Do(u)}(e.databaseInfo);return function(u,l,h,f){return new Vo(u,l,h,f)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,o,u,l,h){return new No(s,o,u,l,h)}(this.localStore,this.datastore,e.asyncQueue,n=>el(this.syncEngine,n,0),function(){return ei.p()?new ei:new Ro}())}createSyncEngine(e,n){return function(o,u,l,h,f,p,T){let b=new jo(o,u,l,h,f,p);return T&&(b.$a=!0),b}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return V(this,null,function*(){var e,n;yield function(o){return V(this,null,function*(){let u=L(o);k("RemoteStore","RemoteStore shutting down."),u.k_.add(5),yield Qn(u),u.Q_.shutdown(),u.K_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();var Ko=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Xa(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Xa(this.observer.error,t):Qt("Uncaught Error in snapshot listener:",t.toString()))}eu(){this.muted=!0}Xa(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Qo=class{constructor(t,e,n,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=ot.UNAUTHENTICATED,this.clientId=qr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,u=>V(this,null,function*(){k("FirestoreClient","Received user=",u.uid),yield this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(n,u=>(k("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new zt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=ma(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function vs(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),k("FirestoreClient","Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(s=>V(this,null,function*(){n.isEqual(s)||(yield Ll(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function rl(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield tm(r);k("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Xc(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Xc(t.remoteStore,s)),r._onlineComponents=t})}function tm(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){k("FirestoreClient","Using user provided OfflineComponentProvider");try{yield vs(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===R.FAILED_PRECONDITION||s.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;Me("Error using user provided cache. Falling back to memory cache: "+e),yield vs(r,new Xl)}}else k("FirestoreClient","Using default OfflineComponentProvider"),yield vs(r,new $o(void 0));return r._offlineComponents})}function Zl(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(k("FirestoreClient","Using user provided OnlineComponentProvider"),yield rl(r,r._uninitializedComponentsProvider._online)):(k("FirestoreClient","Using default OnlineComponentProvider"),yield rl(r,new Zf))),r._onlineComponents})}function em(r){return Zl(r).then(t=>t.syncEngine)}function il(r){return V(this,null,function*(){let t=yield Zl(r),e=t.eventManager;return e.onListen=qf.bind(null,t.syncEngine),e.onUnlisten=jf.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Uf.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=zf.bind(null,t.syncEngine),e})}function th(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var sl=new Map;function eh(r,t,e){if(!e)throw new O(R.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function nm(r,t,e,n){if(t===!0&&n===!0)throw new O(R.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function ol(r){if(!F.isDocumentKey(r))throw new O(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function al(r){if(F.isDocumentKey(r))throw new O(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function _a(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":M()}function Kt(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new O(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=_a(r);throw new O(R.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}var ci=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new O(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new O(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}nm("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=th((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new O(R.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new O(R.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new O(R.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},He=class{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ci({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new O(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ci(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new ws;switch(n.type){case"firstParty":return new As(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new O(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=sl.get(e);n&&(k("ComponentProvider","Removing Datastore"),sl.delete(e),n.terminate())}(this),Promise.resolve()}};function nh(r,t,e,n={}){var s;let o=(r=Kt(r,He))._getSettings(),u=`${t}:${e}`;if(o.host!=="firestore.googleapis.com"&&o.host!==u&&Me("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},o),{host:u,ssl:!1})),n.mockUserToken){let l,h;if(typeof n.mockUserToken=="string")l=n.mockUserToken,h=ot.MOCK_USER;else{l=nc(n.mockUserToken,(s=r._app)===null||s===void 0?void 0:s.options.projectId);let f=n.mockUserToken.sub||n.mockUserToken.user_id;if(!f)throw new O(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new ot(f)}r._authCredentials=new Is(new Br(l,h))}}var li=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},yt=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new re(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},re=class r extends li{constructor(t,e,n){super(t,e,aa(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new yt(this.firestore,null,new F(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function rh(r,t,...e){if(r=Ct(r),eh("collection","path",t),r instanceof He){let n=et.fromString(t,...e);return al(n),new re(r,null,n)}{if(!(r instanceof yt||r instanceof re))throw new O(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(et.fromString(t,...e));return al(n),new re(r.firestore,null,n)}}function ih(r,t,...e){if(r=Ct(r),arguments.length===1&&(t=qr.newId()),eh("doc","path",t),r instanceof He){let n=et.fromString(t,...e);return ol(n),new yt(r,null,new F(n))}{if(!(r instanceof yt||r instanceof re))throw new O(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(et.fromString(t,...e));return ol(n),new yt(r.firestore,r instanceof re?r.converter:null,new F(n))}}var hi=class{constructor(t=Promise.resolve()){this.Iu=[],this.du=!1,this.Eu=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new ni(this,"async_queue_retry"),this.fu=()=>{let n=ys();n&&k("AsyncQueue","Visibility state changed to "+n.visibilityState),this.r_.Jo()},this.gu=t;let e=ys();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.du}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.yu(t)}enterRestrictedMode(t){if(!this.du){this.du=!0,this.Vu=t||!1;let e=ys();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.fu)}}enqueue(t){if(this.pu(),this.du)return new Promise(()=>{});let e=new zt;return this.yu(()=>this.du&&this.Vu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Iu.push(t),this.wu()))}wu(){return V(this,null,function*(){if(this.Iu.length!==0){try{yield this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(t){if(!Ze(t))throw t;k("AsyncQueue","Operation failed with retryable error: "+t)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}})}yu(t){let e=this.gu.then(()=>(this.Ru=!0,t().catch(n=>{this.Au=n,this.Ru=!1;let s=function(u){let l=u.message||"";return u.stack&&(l=u.stack.includes(u.message)?u.stack:u.message+`
`+u.stack),l}(n);throw Qt("INTERNAL UNHANDLED ERROR: ",s),n}).then(n=>(this.Ru=!1,n))));return this.gu=e,e}enqueueAfterDelay(t,e,n){this.pu(),this.mu.indexOf(t)>-1&&(e=0);let s=Oo.createAndSchedule(this,t,e,n,o=>this.Su(o));return this.Eu.push(s),s}pu(){this.Au&&M()}verifyOperationInProgress(){}bu(){return V(this,null,function*(){let t;do t=this.gu,yield t;while(t!==this.gu)})}Du(t){for(let e of this.Eu)if(e.timerId===t)return!0;return!1}vu(t){return this.bu().then(()=>{this.Eu.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.Eu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.bu()})}Cu(t){this.mu.push(t)}Su(t){let e=this.Eu.indexOf(t);this.Eu.splice(e,1)}};function ul(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let s=e;for(let o of n)if(o in s&&typeof s[o]=="function")return!0;return!1}(r,["next","error","complete"])}var oe=class extends He{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new hi,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new hi(t),this._firestoreClient=void 0,yield t}})}};function sh(r,t){let e=typeof r=="object"?r:hc(),n=typeof r=="string"?r:t||"(default)",s=cc(e,"firestore").getImmediate({identifier:n});if(!s._initialized){let o=ec("firestore");o&&nh(s,...o)}return s}function oh(r){if(r._terminated)throw new O(R.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||rm(r),r._firestoreClient}function rm(r){var t,e,n;let s=r._freezeSettings(),o=function(l,h,f,p){return new Ds(l,h,f,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,th(p.experimentalLongPollingOptions),p.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,s);r._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),r._firestoreClient=new Qo(r._authCredentials,r._appCheckCredentials,r._queue,o,r._componentsProvider&&function(l){let h=l?._online.build();return{_offline:l?._offline.build(h),_online:h}}(r._componentsProvider))}var jn=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(gt.fromBase64String(t))}catch(e){throw new O(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(gt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Je=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new O(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new It(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var zn=class{constructor(t){this._methodName=t}};var $n=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new O(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new O(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return G(this._lat,t._lat)||G(this._long,t._long)}};var Kn=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,s){if(n.length!==s.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==s[o])return!1;return!0}(this._values,t._values)}};var im=/^__.*__$/,Wo=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Ot(t,this.data,this.fieldMask,e,this.fieldTransforms):new we(t,this.data,e,this.fieldTransforms)}},di=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Ot(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function ah(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}var Ho=class r{constructor(t,e,n,s,o,u){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,o===void 0&&this.Fu(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.xu({path:n,Nu:!1});return s.Bu(t),s}Lu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.xu({path:n,Nu:!1});return s.Fu(),s}ku(t){return this.xu({path:void 0,Nu:!0})}qu(t){return mi(t,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Fu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Bu(this.path.get(t))}Bu(t){if(t.length===0)throw this.qu("Document fields must not be empty");if(ah(this.Mu)&&im.test(t))throw this.qu('Document fields cannot begin and end with "__"')}},Jo=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ti(t)}$u(t,e,n,s=!1){return new Ho({Mu:t,methodName:e,Ku:n,path:It.emptyPath(),Nu:!1,Qu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function uh(r){let t=r._freezeSettings(),e=Ti(r._databaseId);return new Jo(r._databaseId,!!t.ignoreUndefinedProperties,e)}function sm(r,t,e,n,s,o={}){let u=r.$u(o.merge||o.mergeFields?2:0,t,e,s);ya("Data must be an object, but it was:",u,n);let l=ch(n,u),h,f;if(o.merge)h=new At(u.fieldMask),f=u.fieldTransforms;else if(o.mergeFields){let p=[];for(let T of o.mergeFields){let b=Yo(t,T,e);if(!u.contains(b))throw new O(R.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);hh(p,b)||p.push(b)}h=new At(p),f=u.fieldTransforms.filter(T=>h.covers(T.field))}else h=null,f=u.fieldTransforms;return new Wo(new wt(l),h,f)}var fi=class r extends zn{_toFieldTransform(t){if(t.Mu!==2)throw t.Mu===1?t.qu(`${this._methodName}() can only appear at the top level of your update data`):t.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function om(r,t,e,n){let s=r.$u(1,t,e);ya("Data must be an object, but it was:",s,n);let o=[],u=wt.empty();ae(n,(h,f)=>{let p=va(t,h,e);f=Ct(f);let T=s.Lu(p);if(f instanceof fi)o.push(p);else{let b=bi(f,T);b!=null&&(o.push(p),u.set(p,b))}});let l=new At(o);return new di(u,l,s.fieldTransforms)}function am(r,t,e,n,s,o){let u=r.$u(1,t,e),l=[Yo(t,n,e)],h=[s];if(o.length%2!=0)throw new O(R.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<o.length;b+=2)l.push(Yo(t,o[b])),h.push(o[b+1]);let f=[],p=wt.empty();for(let b=l.length-1;b>=0;--b)if(!hh(f,l[b])){let C=l[b],x=h[b];x=Ct(x);let N=u.Lu(C);if(x instanceof fi)f.push(C);else{let P=bi(x,N);P!=null&&(f.push(C),p.set(C,P))}}let T=new At(f);return new di(p,T,u.fieldTransforms)}function bi(r,t){if(lh(r=Ct(r)))return ya("Unsupported field value:",t,r),ch(r,t);if(r instanceof zn)return function(n,s){if(!ah(s.Mu))throw s.qu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.qu(`${n._methodName}() is not currently supported inside arrays`);let o=n._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Nu&&t.Mu!==4)throw t.qu("Nested arrays are not supported");return function(n,s){let o=[],u=0;for(let l of n){let h=bi(l,s.ku(u));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),u++}return{arrayValue:{values:o}}}(r,t)}return function(n,s){if((n=Ct(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return jd(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let o=ct.fromDate(n);return{timestampValue:Jr(s.serializer,o)}}if(n instanceof ct){let o=new ct(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Jr(s.serializer,o)}}if(n instanceof $n)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof jn)return{bytesValue:xl(s.serializer,n._byteString)};if(n instanceof yt){let o=s.databaseId,u=n.firestore._databaseId;if(!u.isEqual(o))throw s.qu(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:ca(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Kn)return function(u,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:u.toArray().map(h=>{if(typeof h!="number")throw l.qu("VectorValues must only contain numeric values.");return ua(l.serializer,h)})}}}}}}(n,s);throw s.qu(`Unsupported field value: ${_a(n)}`)}(r,t)}function ch(r,t){let e={};return cl(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ae(r,(n,s)=>{let o=bi(s,t.Ou(n));o!=null&&(e[n]=o)}),{mapValue:{fields:e}}}function lh(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ct||r instanceof $n||r instanceof jn||r instanceof yt||r instanceof zn||r instanceof Kn)}function ya(r,t,e){if(!lh(e)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(e)){let n=_a(e);throw n==="an object"?t.qu(r+" a custom object"):t.qu(r+" "+n)}}function Yo(r,t,e){if((t=Ct(t))instanceof Je)return t._internalPath;if(typeof t=="string")return va(r,t);throw mi("Field path arguments must be of type string or ",r,!1,void 0,e)}var um=new RegExp("[~\\*/\\[\\]]");function va(r,t,e){if(t.search(um)>=0)throw mi(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new Je(...t.split("."))._internalPath}catch{throw mi(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function mi(r,t,e,n,s){let o=n&&!n.isEmpty(),u=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||u)&&(h+=" (found",o&&(h+=` in field ${n}`),u&&(h+=` in document ${s}`),h+=")"),new O(R.INVALID_ARGUMENT,l+r+h)}function hh(r,t){return r.some(e=>e.isEqual(t))}var gi=class{constructor(t,e,n,s,o){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Xo(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(dh("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Xo=class extends gi{data(){return super.data()}};function dh(r,t){return typeof t=="string"?va(r,t):t instanceof Je?t._internalPath:t._delegate._internalPath}function cm(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new O(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Zo=class{convertValue(t,e="none"){switch(ie(t)){case 0:return null;case 1:return t.booleanValue;case 2:return X(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ht(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw M()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return ae(t,(s,o)=>{n[s]=this.convertValue(o,e)}),n}convertVectorValue(t){var e,n,s;let o=(s=(n=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(u=>X(u.doubleValue));return new Kn(o)}convertGeoPoint(t){return new $n(X(t.latitude),X(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=vi(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Fn(t));default:return null}}convertTimestamp(t){let e=Wt(t);return new ct(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=et.fromString(t);W(Ml(n));let s=new zr(n.get(1),n.get(3)),o=new F(n.popFirst(5));return s.isEqual(e)||Qt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function lm(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var ge=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},pi=class extends gi{constructor(t,e,n,s,o,u){super(t,e,n,s,u),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Fe(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(dh("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},Fe=class extends pi{data(t={}){return super.data(t)}},ta=class{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new ge(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Fe(this._firestore,this._userDataWriter,n.key,n,new ge(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let u=0;return s._snapshot.docChanges.map(l=>{let h=new Fe(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ge(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:u++}})}{let u=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let h=new Fe(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ge(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter),f=-1,p=-1;return l.type!==0&&(f=u.indexOf(l.doc.key),u=u.delete(l.doc.key)),l.type!==1&&(u=u.add(l.doc),p=u.indexOf(l.doc.key)),{type:hm(l.type),doc:h,oldIndex:f,newIndex:p}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function hm(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M()}}var _i=class extends Zo{constructor(t){super(),this.firestore=t}convertBytes(t){return new jn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new yt(this.firestore,null,e)}};function fh(r,t,e){r=Kt(r,yt);let n=Kt(r.firestore,oe),s=lm(r.converter,t,e);return Ia(n,[sm(uh(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,$t.none())])}function mh(r,t,e,...n){r=Kt(r,yt);let s=Kt(r.firestore,oe),o=uh(s),u;return u=typeof(t=Ct(t))=="string"||t instanceof Je?am(o,"updateDoc",r._key,t,e,n):om(o,"updateDoc",r._key,t),Ia(s,[u.toMutation(r._key,$t.exists(!0))])}function gh(r){return Ia(Kt(r.firestore,oe),[new Ln(r._key,$t.none())])}function wa(r,...t){var e,n,s;r=Ct(r);let o={includeMetadataChanges:!1,source:"default"},u=0;typeof t[u]!="object"||ul(t[u])||(o=t[u],u++);let l={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(ul(t[u])){let T=t[u];t[u]=(e=T.next)===null||e===void 0?void 0:e.bind(T),t[u+1]=(n=T.error)===null||n===void 0?void 0:n.bind(T),t[u+2]=(s=T.complete)===null||s===void 0?void 0:s.bind(T)}let h,f,p;if(r instanceof yt)f=Kt(r.firestore,oe),p=aa(r._key.path),h={next:T=>{t[u]&&t[u](dm(f,r,T))},error:t[u+1],complete:t[u+2]};else{let T=Kt(r,li);f=Kt(T.firestore,oe),p=T._query;let b=new _i(f);h={next:C=>{t[u]&&t[u](new ta(f,b,T,C))},error:t[u+1],complete:t[u+2]},cm(r._query)}return function(b,C,x,N){let P=new Ko(N),U=new Bo(C,P,x);return b.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return Ff(yield il(b),U)})),()=>{P.eu(),b.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return Mf(yield il(b),U)}))}}(oh(f),p,l,h)}function Ia(r,t){return function(n,s){let o=new zt;return n.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return $f(yield em(n),s,o)})),o.promise}(oh(r),t)}function dm(r,t,e){let n=e.docs.get(t._key),s=new _i(r);return new pi(r,s,t._key,n,new ge(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){(function(s){Ye=s})(lc),uc(new oc("firestore",(n,{instanceIdentifier:s,options:o})=>{let u=n.getProvider("app").getImmediate(),l=new oe(new Ts(n.getProvider("auth-internal")),new Ss(n.getProvider("app-check-internal")),function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new O(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zr(f.options.projectId,p)}(u,s),u);return o=Object.assign({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),Rn(Dc,"4.7.6",t),Rn(Dc,"4.7.6","esm2017")})();var Si=function(){return Si=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Si.apply(this,arguments)};var gm={includeMetadataChanges:!1};function Ta(r,t){return t===void 0&&(t=gm),new Cu(function(e){var n=wa(r,t,{next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)});return{unsubscribe:n}})}function ph(r){return Ta(r,{includeMetadataChanges:!0})}function _h(r,t){return t===void 0&&(t={}),ph(r).pipe(fr(function(e){return Ea(e,t)}))}function Ea(r,t){var e;t===void 0&&(t={});var n=r.data(t);return!r.exists()||typeof n!="object"||n===null||!t.idField?n:Si(Si({},n),(e={},e[t.idField]=r.id,e))}function yh(r){return Ta(r,{includeMetadataChanges:!0}).pipe(fr(function(t){return t.docs}))}function vh(r,t){return t===void 0&&(t={}),yh(r).pipe(fr(function(e){return e.map(function(n){return Ea(n,t)})}))}var Hn=class{constructor(t){return t}},wh="firestore",Aa=class{constructor(){return mc(wh)}};var ba=new Rt("angularfire2.firestore-instances");function pm(r,t){let e=fc(wh,r,t);return e&&new Hn(e)}function _m(r){return(t,e)=>{let n=t.runOutsideAngular(()=>r(e));return new Hn(n)}}var ym={provide:Aa,deps:[[new Tn,ba]]},vm={provide:Hn,useFactory:pm,deps:[[new Tn,ba],pc]};function Yp(r,...t){return Rn("angularfire",dc.full,"fst"),xu([vm,ym,{provide:ba,useFactory:_m(r),multi:!0,deps:[vr,de,gc,_c,[new Tn,vc],[new Tn,yc],...t]}])}var Xp=Ut(vh,!0);var Zp=Ut(_h,!0);var t_=Ut(rh,!0,2);var e_=Ut(gh,!0,2);var n_=Ut(ih,!0,2);var r_=Ut(sh,!0);var i_=Ut(fh,!0,2);var s_=Ut(mh,!0,2);export{Pr as a,bc as b,ig as c,sg as d,og as e,ag as f,nh as g,Hn as h,Yp as i,Xp as j,Zp as k,t_ as l,e_ as m,n_ as n,r_ as o,i_ as p,s_ as q};
